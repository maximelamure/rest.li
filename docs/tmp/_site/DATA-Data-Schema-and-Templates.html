<!DOCTYPE html>
<html lang="en">

  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-128576866-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-128576866-1');
    </script>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>

    <title>DATA-Data-Schema-and-Templates</title>
    <meta name="description" content="A REST framework for building scalable service architectures using dynamic discovery and simple asynchronous APIs" />

    <link rel="icon"
      type="image/png"
      href="/rest.li/images/icon_pegasus.png">
  
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" type="text/css" media="screen,projection" href="/assets/materialize.css" />
    <link rel="stylesheet" type="text/css" media="screen,projection" href="/assets/main.css">
    <link rel="canonical" href="http://localhost:4000/DATA-Data-Schema-and-Templates" />
    <link rel="alternate" type="application/rss+xml" title="rest.li" href="/feed.xml" />

    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
  
    
    <script>
       $(function() {
          $("h1").addClass("no_toc");
       });
    </script>
</head>


  <body>

    <nav class="dark-grey" role="navigation">
    <div class="nav-wrapper container"><a id="logo-container" class="brand-logo" href="/">Rest.li</a>


          <ul class="right hide-on-med-and-down">
               
      
        <li>
          <a href="/rest.li/get_started/quick_start" >
            Getting Started
          </a>
        </li>
        
        <li>
          <a href="/rest.li/user_guide/server_architecture" >
            User Guide
          </a>
        </li>
        
        <li>
          <a href="/rest.li/spec/protocol" >
            API Reference
          </a>
        </li>
        
        <li>
          <a href="/rest.li/contribute/howto" >
            Contribute
          </a>
        </li>
        
        <li>
          <a href="http://github.com/linkedin/rest.li/" >
            GITHUB
          </a>
        </li>
        
          </ul>


      <a href="#" data-activates="nav-mobile" class="button-collapse"><i class="material-icons">menu</i></a>
    </div>
</nav>


        <div class="container">
        <div class="row">
                <div class="col s12 m4 l3"> 
               
                    
                   
                    
                     <ul class="nav_items">
                        <li><span class="nav_sub-title">User Guide</span></li>
                        <ul>
                       
                         <li><a href="/rest.li/user_guide/server_architecture">Rest.li Architecture</a></li>
                       
                         <li><a href="/rest.li/user_guide/restli_server">Rest.li Server</a></li>
                       
                         <li><a href="/rest.li/user_guide/restli_client">Rest.li Client Framework</a></li>
                       
                         <li><a href="/rest.li/user_guide/unstructured_data">Unstructured Data</a></li>
                       
                         <li><a href="/rest.li/Components">Components</a></li>
                       
                         <li><a href="/rest.li/Asynchronous-Servers-and-Clients-in-Rest_li">Asynchronous in Rest.li</a></li>
                       
                        </ul>
                     </ul>
                        
                   
                    
                     <ul class="nav_items">
                        <li><span class="nav_sub-title">Modeling Resources</span></li>
                        <ul>
                       
                         <li><a href="/rest.li/DATA-Data-Schema-and-Templates">Data schema and templates</a></li>
                       
                         <li><a href="/rest.li/modeling/modeling">Modeling Resources</a></li>
                       
                         <li><a href="/rest.li/modeling/compatibiltiy_check">Snapshots and Resource Compatibility Checking</a></li>
                       
                        </ul>
                     </ul>
                        
                   
                    
                     <ul class="nav_items">
                        <li><span class="nav_sub-title">Main concepts</span></li>
                        <ul>
                       
                         <li><a href="/rest.li/Rest_li-Filters">Filters</a></li>
                       
                         <li><a href="/rest.li/Projections">Projections</a></li>
                       
                         <li><a href="/rest.li/Validation-in-Rest_li">Validation</a></li>
                       
                         <li><a href="/rest.li/Attachment-Streaming">Attachment Streaming</a></li>
                       
                        </ul>
                     </ul>
                        
                   
                    
                     <ul class="nav_items">
                        <li><span class="nav_sub-title">Mutli-language</span></li>
                        <ul>
                       
                         <li><a href="/rest.li/multi_language_compatibility_matrix">Compatibility Matrix</a></li>
                       
                         <li><a href="/rest.li/test_suite">Test Suite</a></li>
                       
                         <li><a href="https://github.com/mchen07/restli-csharp">C#</a></li>
                       
                         <li><a href="/rest.li/Scala-Integration">Scala integration</a></li>
                       
                        </ul>
                     </ul>
                        
                   
                    
                     <ul class="nav_items">
                        <li><span class="nav_sub-title">Testing</span></li>
                        <ul>
                       
                         <li><a href="/rest.li/Writing-unit-tests-for-Rest_li-clients-and-servers">Writing unit tests</a></li>
                       
                        </ul>
                     </ul>
                        
                   
                    
                     <ul class="nav_items">
                        <li><span class="nav_sub-title">How to</span></li>
                        <ul>
                       
                         <li><a href="/rest.li/Send-Rest_li-Request-Query-In-Request-Body">Send request query in the body</a></li>
                       
                         <li><a href="/rest.li/How-to-use-projections-in-Java">Use projections</a></li>
                       
                         <li><a href="/rest.li/Rest_li_Avro_conversions">Avro conversion</a></li>
                       
                         <li><a href="/rest.li/Compression">Compression</a></li>
                       
                         <li><a href="/rest.li/Rest_li-2_x-upgrade-instructions">Migrate to Rest.li 2.x</a></li>
                       
                         <li><a href="/rest.li/testsuite_how_to">Test Suite</a></li>
                       
                         <li><a href="/rest.li/howto_add_new_language">Test suite - Add new language</a></li>
                       
                        </ul>
                     </ul>
                        
                   
                    
                     <ul class="nav_items">
                        <li><span class="nav_sub-title">FAQ</span></li>
                        <ul>
                       
                         <li><a href="/rest.li/Data-FAQ">Rest.li - FAQ</a></li>
                       
                         <li><a href="/rest.li/testsuite_troubleshooting">Test suite - Troubleshooting</a></li>
                       
                        </ul>
                     </ul>
                        
                    </div>
                     <div class="markdown-body col s12 m3 l9">
                            <h1 id="data-schema-and-template">Data schema and template</h1>

<p>This page contains the following sections</p>

<ul>
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#schema-definition">Schema Definition</a></li>
  <li><a href="#how-data-is-serialized-for-transport">How Data is Serialized for
Transport</a></li>
  <li><a href="#how-data-is-represented-in-memory">How Data is Represented in
Memory</a></li>
  <li><a href="#java-binding">Java Binding</a></li>
  <li><a href="#avro-translation">Avro Translation</a></li>
</ul>

<h2 id="introduction">Introduction</h2>

<p>The Pegasus Data layer includes the following:</p>

<ul>
  <li>The schema definition language for specifying the data that will be
exchanged among systems</li>
  <li>How this data will be serialized for transport</li>
  <li>How this data will be represented in memory</li>
  <li>The generic and type-safe Java API’s for manipulating data. These
generated Java classes are referred to as the ‘data templates’.</li>
</ul>

<h2 id="schema-definition">Schema Definition</h2>

<p>The Pegasus schema definition language is inspired by the <a href="http://avro.apache.org/docs/1.4.1/spec.html">Avro 1.4.1
specification</a>.</p>

<ul>
  <li>Pegasus leverages Avro’s JSON-based schema definition syntax, type
system, and JSON serialization format.</li>
  <li>Pegasus does not implement or use Avro’s binary data serialization
format, object container files, protocol wire format, and schema
resolution.</li>
  <li>Pegasus does not require or re-use any Avro implementation.</li>
  <li>The code generator supports all of Avro’s types: primitive types,
records, enums, arrays, maps, unions, fixed.</li>
</ul>

<p>The Pegasus schema differs from Avro in the following ways:</p>

<ul>
  <li>Pegasus uses “optional” to indicate that a field in a record is
optional. Union with null should not be used to indicate an optional
field. Future versions of Pegasus may remove the null type from the
schema definition language.</li>
  <li>Pegasus unions can have more than one member of the same type. This
is supported by specifying an alias for each member which is unique
within that union.</li>
  <li>Pegasus default values for union types must include the member
discriminator. Avro default values for union types do not include
the member discriminator. The type of the Avro union default value
is always the 1st member type of the union.</li>
  <li>Pegasus implements a mechanism for including all the fields from
another record into the current record.</li>
  <li>Pegasus schema files have file names that ends with <code class="highlighter-rouge">.pdsc</code> instead
of <code class="highlighter-rouge">.avsc</code>.</li>
  <li>The Pegasus code generator also implements resolvers similar to Java
class loaders that allow each named schema to be specified in a
different source file.<br />
(Note the Avro code generator requires all referenced named schemas
to be in the same source file. The schema resolver of the Pegasus
code generator is unrelated to the schema resolution feature of
Avro.)</li>
  <li>Pegasus ignores the aliases (but allows them in the schema
definition). Future versions of Pegasus may remove aliases.</li>
  <li>Pegasus schema resolution and compatibility rules are different.</li>
  <li>Pegasus named schema provides option to override language binding
namespace for generated data model from the schema. <strong>Note that this
binding namespace override will not change how data is transported
over the wire.</strong></li>
</ul>

<h3 id="creating-a-schema">Creating a Schema</h3>

<p>Each schema should be stored in its own file with a <code class="highlighter-rouge">.pdsc</code> extension.
The Pegasus code generator implements a resolver that is similar to Java
class loaders. If there is a reference to a named schema, the code
generator will try to look for a file in the code generator’s resolver
path. The resolver path is similar to a Java classpath. The fully
qualified name of the named schema will be translated to a relative file
name. The relative file name is computed by replacing dots (“.”) in the
fully qualified name by the directory path separator (typically “/”) and
appending a <code class="highlighter-rouge">.pdsc</code> extension. This relative file name is appended to
each path in the resolver path. The resolver opens each of these files
until it finds a file that contains the named schema.</p>

<p>The named schema declarations support the following attributes:</p>

<ul>
  <li><code class="highlighter-rouge">type</code> a JSON string providing the type of the named schema
(required).</li>
  <li><code class="highlighter-rouge">name</code> a JSON string providing the name of the named schema
(required).</li>
  <li><code class="highlighter-rouge">namespace</code> a JSON string that qualifies the namespace for the named
schema.</li>
  <li><code class="highlighter-rouge">package</code> a JSON string that qualifies the language binding
namespace for the named schema (optional). If this is not specified,
language binding class for the named schema will use <code class="highlighter-rouge">namespace</code> as
its default namespace.</li>
  <li><code class="highlighter-rouge">doc</code> a JSON string providing documentation to the user of this
named schema (optional).</li>
</ul>

<p>The named schemas with type “enum” also supports a <code class="highlighter-rouge">symbolDocs</code>
attribute to provide documentation for each enum symbol.</p>

<p><strong>Note:</strong> Due to the addition of doclint in JDK8, anything under the
<code class="highlighter-rouge">doc</code> or <code class="highlighter-rouge">symbolDocs</code> attribute must be W3C HTML 4.01 compliant. This is
because the contents of this string will appear as Javadocs in the
generated Java ‘data template’ classes later. Please take this into
consideration when writing your documentation.</p>

<p>The following are a few example schemas and their file names.</p>

<p>com/linkedin/pegasus/generator/examples/Foo.pdsc</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {
    "type" : "record",
    "name" : "Foo",
    "namespace" : "com.linkedin.pegasus.generator.examples",
    "doc" : "A foo record",
    "fields" : [
      { "name" : "intField",       "type" : "int" },
      { "name" : "longField",      "type" : "long" },
      { "name" : "floatField",     "type" : "float" },
      { "name" : "doubleField",    "type" : "double" },
      { "name" : "bytesField",     "type" : "bytes" },
      { "name" : "stringField",    "type" : "string" },
      { "name" : "fruitsField",    "type" : "Fruits" },
      { "name" : "intArrayField",  "type" : { "type" : "array", "items" : "int" } },
      { "name" : "stringMapField", "type" : { "type" : "map", "values" : "string" } },
      {
        "name" : "unionField",
        "type" : [
          "int",
          "string",
          "Fruits",
          "Foo",
          { "type" : "array", "items" : "string" },
          { "type" : "map", "values" : "long" },
          "null"
        ]
      }
    ]
  }
</code></pre></div></div>

<p>com/linkedin/pegasus/generator/examples/FooWithNamespaceOverride.pdsc
(please see Java Binding section to see how this “package” affects
generated java class.)</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {
    "type" : "record",
    "name" : "FooWithNamespaceOverride",
    "namespace" : "com.linkedin.pegasus.generator.examples",
    "package" : "com.linkedin.pegasus.generator.examples.record",
    "doc" : "A foo record",
    "fields" : [
      { "name" : "intField",       "type" : "int" },
      { "name" : "longField",      "type" : "long" },
      { "name" : "floatField",     "type" : "float" },
      { "name" : "doubleField",    "type" : "double" },
      { "name" : "bytesField",     "type" : "bytes" },
      { "name" : "stringField",    "type" : "string" },
      { "name" : "fruitsField",    "type" : "Fruits" },
      { "name" : "intArrayField",  "type" : { "type" : "array", "items" : "int" } },
      { "name" : "stringMapField", "type" : { "type" : "map", "values" : "string" } },
      {
        "name" : "unionField",
        "type" : [
          "int",
          "string",
          "Fruits",
          "Foo",
          { "type" : "array", "items" : "string" },
          { "type" : "map", "values" : "long" },
          "null"
        ]
      }
    ]
  }
</code></pre></div></div>

<p>com/linkedin/pegasus/generator/examples/Fruits.pdsc</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {
    "type" : "enum",
    "name" : "Fruits",
    "namespace" : "com.linkedin.pegasus.generator.examples",
    "doc" : "A fruit",
    "symbols" : [ "APPLE", "BANANA", "ORANGE", "PINEAPPLE" ],
    "symbolDocs" : { "APPLE":"A red, yellow or green fruit.", "BANANA":"A yellow fruit.", "ORANGE":"An orange fruit.", "PINEAPPLE":"A yellow fruit."} 
  }
</code></pre></div></div>

<p>com/linkedin/pegasus/generator/examples/MD5.pdsc</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {
    "type" : "fixed",
    "name" : "MD5",
    "namespace" : "com.linkedin.pegasus.generator.examples",
    "doc" : "MD5",
    "size" : 16
  }
</code></pre></div></div>

<p>com/linkedin/pegasus/generator/examples/StringList.pdsc</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {
    "type" : "record",
    "name" : "StringList",
    "namespace" : "com.linkedin.pegasus.generator.examples",
    "doc" : "A list of strings",
    "fields" : [
      { "name" : "element", "type" : "string" },
      { "name" : "next"   , "type" : "StringList", "optional" : true }
    ]
  
  }
</code></pre></div></div>

<p>com/linkedin/pegasus/generator/examples/InlinedExample.pdsc</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {
    "type": "record",
    "name": "InlinedExample",
    "namespace": "com.linkedin.pegasus.generator.examples",
    "doc": "Example on how you can declare an enum and a record inside another record",
    "fields": [
      {
        "name": "myEnumField",
        "type": {
        "type" : "enum",
        "name" : "EnumDeclarationInTheSameFile",
        "symbols" : ["FOO", "BAR", "BAZ"]
        },
        "doc": "This is how we inline enum declaration without creating a new pdsc file",
        "symbolDocs": {"FOO":"It's a foo!", "HASH":"It's a bar!", "NONE":"It's a baz!"}
      },
      {
        "name": "stringField",
        "type": "string",
        "doc": "A regular string"
      },
      {
        "name": "intField",
        "type": "int",
        "doc": "A regular int"
      },
      {
        "name": "UnionFieldWithInlineRecordAndEnum",
        "doc": "In this example we will declare a record and an enum inside a union",
        "type": [
          {
            "type" : "record",
            "name" : "myRecord",
            "fields": [
              {
                "name": "foo1",
                "type": "int",
                "doc": "random int field"
              },
              {
                "name": "foo2",
                "type": "int",
                "doc": "random int field"
              }
            ]
          },
          {
            "name": "anotherEnum",
            "type" : "enum",
            "symbols" : ["FOOFOO", "BARBAR"],
            "doc": "Random enum",
            "symbolDocs": {"FOOFOO":"description about FOOFOO", "BARBAR":"description about BARBAR"}
          }
        ],
        "optional": true
      }
    ]
  }
</code></pre></div></div>

<h3 id="typeref">Typeref</h3>

<p>Pegasus supports a new schema type known as a typeref. A typeref is like
a typedef in C. It does not declare a new type but declares an alias to
an existing type.</p>

<ul>
  <li>Typerefs are useful for differentiating different uses of the same
type. For example, we can use to a typeref to differentiate a string
field that holds an URN (uniform resource name) from an arbitrary
string value or a long field that holds an epoch time in
milliseconds from a generic long value.</li>
  <li>A typeref allows additional meta-data to be associated with
primitive and unnamed types. This meta-data can be used to provide
documentation or support custom properties.</li>
  <li>A typeref provides a way to refer to common unnamed types such as
arrays, maps, and unions. Without typerefs, users may have to wrap
these unnamed types with a record in order to address them.
Alternatively, users may cut-and-paste common type declarations,
resulting in unnecessary duplication and potentially causing
inconsistencies if future changes are not propagated correctly to
all copies.</li>
</ul>

<p>Typerefs use the type name “typeref” and support the following
attributes:</p>

<ul>
  <li><code class="highlighter-rouge">name</code> a JSON string providing the name of the typeref (required).</li>
  <li><code class="highlighter-rouge">namespace</code> a JSON string that qualifies the name;</li>
  <li><code class="highlighter-rouge">package</code> a JSON string that qualifies the language binding
namespace for this typeref (optional). If this is not specified,
language binding class for the typeref will use <code class="highlighter-rouge">namespace</code> as its
default namespace.</li>
  <li><code class="highlighter-rouge">doc</code> a JSON string providing documentation to the user of this
schema (optional).</li>
  <li><code class="highlighter-rouge">ref</code> the schema that the typeref refers to.</li>
</ul>

<p><strong>Note:</strong> Due to the addition of doclint in JDK8, anything under the
<code class="highlighter-rouge">doc</code> attribute must be W3C HTML 4.01 compliant. This is because the
contents of this string will appear as Javadocs in the generated Java
‘data template’ classes later. Please take this into consideration
when writing your documentation.</p>

<p>Here are a few examples:</p>

<p>Differentiate URN from string</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {
    "type" : "typeref",
    "name" : "URN",
    "ref"  : "string",
    "doc"  : "A URN, the format is defined by RFC 2141"
  }
</code></pre></div></div>

<p>Differentiate time from long</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {
    "type" : "typeref",
    "name" : "time",
    "ref"  : "long",
    "doc"  : "Time in milliseconds since Jan 1, 1970 UTC"
  }
</code></pre></div></div>

<p>Typerefs (by default) do not alter the serialization format or in-memory
representation.</p>

<h3 id="record-field-attributes">Record Field Attributes</h3>

<p>You can use the following record field attributes to annotate fields
with metadata.</p>

<ul>
  <li><code class="highlighter-rouge">optional</code> - marks the field as optional, meaning it doesn’t require
a value. See <a href="#OptionalFields">Optional Fields</a>.</li>
</ul>

<p><a name="OptionalFields"></a></p>

<h3 id="optional-fields">Optional Fields</h3>

<p>Pegasus supports optional fields implicitly through the “optional” flag
in the field definition. A field is required unless the field is
declared with the optional flag set to true. A field without the
optional flag is required. A field with the optional flag set to false
is also required. An optional field may be present or absent in the
in-memory data structure or serialized data.</p>

<p>The Java binding provides methods to determine if an optional field is
present and a specialized get accessor allows the caller to specify
whether the default value or null should be returned when an absent
optional field is accessed. The has field accessor may also be used to
determine if an optional field is present.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {
    "type" : "record",
    "name" : "Optional",
    "namespace" : "com.linkedin.pegasus.generator.examples",
    "fields" :
    [
      {
        "name"     : "foo",
        "type"     : "string",
        "optional" : true
      }
    ]
  }
</code></pre></div></div>

<p>Optional field present</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {
    "foo" : "abcd"
  }
</code></pre></div></div>

<p>Optional field absent</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {
  }
</code></pre></div></div>

<p>See <a href="#GetMode">GetMode</a> for more detailed information on how the code
generated data stubs access optional/default fields.</p>

<h4 id="avros-approach-to-declaring-optional-fields">Avro’s Approach to Declaring Optional Fields</h4>

<p>DO NOT USE UNION WITH NULL TO DECLARE AN OPTIONAL FIELD IN PEGASUS.</p>

<p>Avro’s approach to declaring an optional field is to use a union type
whose values may be null or the desired value type. Pegasus discourages
this practice and may remove support for union with null as well as the
null type in the future. The reason for this is that declaring an
optional field using a union causes the optional field to be always
present in the underlying in-memory data structure and serialized data.
Absence of a value is represented by a null value. Presence of a value
is represented by a value in the union of the value’s type.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {
    "type" : "record",
    "name" : "OptionalWithUnion",
    "namespace" : "com.linkedin.pegasus.generator.examples",
    "fields" :
    [
      {
        "name"    : "foo",
        "type"    : ["string", "null"]
      }
    ]
  }
</code></pre></div></div>

<p>optional field present</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {
    "foo" : { "string" : "abcd" }
  }
</code></pre></div></div>

<p>optional field absent</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {
    "foo" : null
  }
</code></pre></div></div>

<p>Note Avro uses the union approach because Avro serialization is
optimized to not include a field identifier in the serialized data.</p>

<h3 id="union">Union</h3>

<p>Union is a powerful way to model data that can be of different types at
different scenarios. Record fields that have this behavior can be
defined as a Union type with the expected value types as its members.
Here is an example of a record field defined an a union with <code class="highlighter-rouge">string</code>
and <code class="highlighter-rouge">array</code> as its members.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {
    "type" : "record",
    "name" : "RecordWithUnion",
    "namespace" : "com.linkedin.pegasus.examples",
    "fields" :
    [
      {
        "name" : "result",
        "type" : [
          "string",
          {
            "type" : "array",
            "items" : "Result"
          }
        ]
      }
    ]
  }
</code></pre></div></div>

<h4 id="union-with-members-of-the-same-type">Union With Members Of The Same Type</h4>

<p>In addition to the unions with disparate member types, Pegasus unions
can have more than one member of the same type inside a single union
definition. For example a union can have multiple members that are of,</p>

<ul>
  <li>same primitive type</li>
  <li>same named complex type</li>
  <li>array of same or different item types</li>
  <li>map of same or different value types</li>
  <li>typeref dereferenced to same type.</li>
</ul>

<p>Such unions <strong>must</strong> specify an unique alias for each member in the
union definition. When an alias is specified, it acts as the member’s
discriminator unlike the member type name on the standard unions
<a href="#union">defined above</a>.</p>

<p>In the example below, the union definition has a <code class="highlighter-rouge">string</code> and two
<code class="highlighter-rouge">array</code> members with unique aliases for each of them.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {
    "type" : "record",
    "name" : "RecordWithAliasedUnion",
    "namespace" : "com.linkedin.pegasus.examples",
    "fields" :
    [
      {
        "name" : "result",
        "type" : [
          {
            "type" : "string",
            "alias" : "message"
          },
          {
            "type": {
              "type" : "array",
              "items" : "Result"
            },
            "alias" : "successResults"
          },
          {
            "type": {
              "type" : "array",
              "items" : "Result"
            },
            "alias" : "failureResults"
          }
        ]
      }
    ]
  }
</code></pre></div></div>

<p>There are few constraints that must be taken in consideration while
specifying aliases for union members,</p>

<ol>
  <li>Aliases must be unique for each member in a union definition.</li>
  <li>Aliases must be specified for either all or none of the members in a
union definition.</li>
  <li>Aliases cannot be specified for <code class="highlighter-rouge">null</code> member types which means
there can only be one null member inside a union definition.</li>
</ol>

<h3 id="default-values">Default Values</h3>

<p>A field may be declared to have a default value. The default value will
be validated against the schema type of the field. For example, if the
type is record and it has non-optional fields, then the default value
must include the non-optional fields in the default value.</p>

<p>A default value may be declared for a required or an optional field. The
default value is used by the get accessor. Unlike Avro, default values
are not assigned to absent fields on de-serialization.</p>

<p>If a default value is declared for a required field, for all three
<a href="#GetMode">GetMode</a>, the get accessor behaves the same as that for an
optional field with a default value. More specifically, the get accessor
doesn’t fail even if the field is absent. However, in this case, <a href="#data-to-schema-validation">data
validation</a> may fail if
<a href="#requiredmode">RequiredMode</a> is set to <code class="highlighter-rouge">MUST_BE_PRESENT</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {
    "type" : "record",
    "name" : "Default",
    "namespace" : "com.linkedin.pegasus.generator.examples",
    "fields" :
    [
      {
        "name"     : "mandatoryWithDefault",
        "type"     : "string",
        "default"  : "this is the default string"
      },
      {
        "name"     : "optionalWithDefault",
        "type"     : "string",
        "optional" : true,
        "default"  : "this is the default string"
      }
    ]
  }
</code></pre></div></div>

<p>See <a href="#GetMode">GetMode</a> for more detailed information on how the code
generated data stubs access optional/default fields.</p>

<h4 id="default-values-for-union-types">Default Values for Union Types</h4>

<p>An Avro default value for a union type does not include the member
discriminator and the type of the default value must be the first member
type in the list of member types.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {
    ...
    "fields" :
    [
      {
        "name"     : "foo",
        "type"     : [ "int", "string" ],
        "default"  : 42
      }
    ]
  }
</code></pre></div></div>

<p>A Pegasus default value for a union type must include the member
discriminator. This allows the same typeref’ed union to have default
values of different member types.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {
    ...
    "fields" :
    [
      {
        "name"     : "foo",
        "type"     : [ "int", "string" ]
        "default"  : { "int" : 42 }
      }
    ]
  }
</code></pre></div></div>

<p>For unions with aliased members, the specified alias is used as member
discriminator instead of the type name.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {
    ...
    "fields" :
    [
      {
        "name"     : "foo",
        "type"     : [
          { "type" : "int", "alias" : "count" },
          { "type" : "string", "alias" : "message" }
        ],
        "default"  : { "count" : 42 }
      }
    ]
  }
</code></pre></div></div>

<p>Note the Avro syntax optimizes the most common union with null pattern
that is used to represent optional fields to be less verbose. However,
Pegasus has explicit support for optional fields and discourages the use
of union with null. This significantly reduces the syntactical sugar
benefit of the Avro optimization.</p>

<p>If a union type may be translated to Avro, all default values provided
for the union type must be of the first member type in the list of
member types. This restriction is because Avro requires default values
of a union type to be of the first member type of the union.</p>

<h3 id="including-fields-from-another-record">Including Fields from Another Record</h3>

<p>Pegasus implements the “include” attribute. It is used to include all
fields from another record into the current record. It does not include
any other attribute of the record. Include is transitive, if record A
includes record B and record B includes record C, record A contains all
the fields declared in record A, record B and record C.</p>

<p>The value of the “include” attribute should be a list of records or
typerefs of records. It is an error to specify non-record types in this
list.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {
    "doc"  : "Bar includes fields of Foo, Bar will have fields f1 from itself and b1 from Bar",
    "type" : "record",
    "name" : "Bar",
    "include" : [ "Foo" ],
    "fields" : [
      {
        "name"     : "b1",
        "type"     : "string",
      }
    ]
  }
  
  {
    "type" : "record",
    "name" : "Foo",
    "fields" : [
      {
        "name"     : "f1",
        "type"     : "string",
      }
    ]
  }
</code></pre></div></div>

<h3 id="deprecation">Deprecation</h3>

<p>Named schema, record field, and enum symbol can be deprecated using
<code class="highlighter-rouge">deprecated</code> property or <code class="highlighter-rouge">deprecatedSymbols</code> property in enum
declaration. The property value can be a string describing why the
schema element is deprecated or an alternative, or simply boolean
<code class="highlighter-rouge">true</code>. However, the latter use is discouraged and may be removed in the
future. The Java binding generated for these elements will be marked as
deprecated.</p>

<h4 id="named-schema">Named Schema</h4>

<p>To deprecate a named schema, add <code class="highlighter-rouge">deprecated</code> property to its
declaration.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {
    "type" : "record",
    "name" : "Deprecated",
    "namespace" : "com.linkedin.pegasus.generator.test",
    "deprecated": "Use Foo instead.",
    "fields" : [
      ...
    ]
  }
</code></pre></div></div>

<h4 id="record-field">Record Field</h4>

<p>To deprecate a record field, add <code class="highlighter-rouge">deprecated</code> property to its
declaration.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {
    "type" : "record",
    "name" : "Foo",
    "namespace" : "com.linkedin.pegasus.generator.test",
    "fields" : [
      {
        "name" : "deprecatedInt",
        "type" : "int",
        "deprecated": "Reason for int deprecation."
      }
    ]
  }
</code></pre></div></div>

<h4 id="enum-symbol">Enum Symbol</h4>

<p>To deprecate an enum symbol, add <code class="highlighter-rouge">deprecatedSymbols</code> property to the
enum declaration. The value of the property is a map from the symbol
name to a string description.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {
    "name" : "Planet",
    "namespace" : "com.linkedin.pegasus.generator.test",
    "type" : "enum",
    "symbols" : [ "MERCURY", "VENUS", "EARTH", "MARS", "JUPITER", "SATURN", "URANUS", "NEPTUNE", "PLUTO" ],
    "deprecatedSymbols": {
      "PLUTO": "Reclassified as dwarf planet."
    }
  }
</code></pre></div></div>

<p><a name="HowDataisSerializedforTransport"></a></p>

<h2 id="how-data-is-serialized-for-transport">How Data is Serialized for Transport</h2>

<p>The data is serialized for transport using JSON encoding in following
the Avro 1.4.1 specification. This JSON encoding is also the same as the
JSON expression used to describe default values.</p>

<p><strong>One notable difference from the Avro spec is that optional fields with
no value are represented by its omission in the serialized data. To
phrase it differently, optional fields are never explicitly set to
<code class="highlighter-rouge">null</code> in the serialized body.</strong> As such, <code class="highlighter-rouge">null</code> is never a valid value
to appear in the serialized data. The only exception to this rule is if
the schema for the data is a union that has a <code class="highlighter-rouge">null</code> member.</p>

<p>The following table summarizes the JSON encoding.</p>

<table>
<thead>
<tr class="header">
<th>Schema Type <br /></th>
<th>JSON Type <br /></th>
<th>JSON Encoding Examples <br /></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>int <br /></td>
<td>number <br /></td>
<td>123 <br /></td>
</tr>
<tr class="even">
<td>long <br /></td>
<td>number <br /></td>
<td>123456789000 <br /></td>
</tr>
<tr class="odd">
<td>float <br /></td>
<td>number <br /></td>
<td>3.5 <br /></td>
</tr>
<tr class="even">
<td>double <br /></td>
<td>number <br /></td>
<td>3.5555555 <br /></td>
</tr>
<tr class="odd">
<td>boolean <br /></td>
<td>true or false <br /></td>
<td>true <br /></td>
</tr>
<tr class="even">
<td>string <br /></td>
<td>string <br /></td>
<td>“hello” <br /></td>
</tr>
<tr class="odd">
<td>bytes <br /></td>
<td>string (bytes encoded as least significant 8-bits of 16-bit character) <br /></td>
<td>“\u00ba\u00db\u00ad” <br /></td>
</tr>
<tr class="even">
<td>enum <br /></td>
<td>string <br /></td>
<td>“APPLE” <br /></td>
</tr>
<tr class="odd">
<td>fixed <br /></td>
<td>string (bytes encoded as least significant 8-bits of 16-bit character)</td>
<td>“\u0001\u0002\u0003\u0004” (fixed of size 4) <br /></td>
</tr>
<tr class="even">
<td>array <br /></td>
<td>array <br /></td>
<td>[ 1, 2, 3 ] <br /></td>
</tr>
<tr class="odd">
<td>map <br /></td>
<td>object <br /></td>
<td>{ “a” : 95, “b” : 90, “c” : 85 } <br /></td>
</tr>
<tr class="even">
<td>record (error) <br /></td>
<td>object (each field is encoded using a name/value pair in the object) <br /></td>
<td>{ “intField” : 1, “stringField” : “abc”, “fruitsField” : “APPLE” }</td>
</tr>
<tr class="odd">
<td>union <br /></td>
<td>null if value is null. <br /><br />
object if member value is not null with only one name/value pair in the object. The name will be the member discriminator (<strong>NOTE Member discriminator will be the member’s alias if one is specified, else it is the member’s fully qualified type name.</strong>) and value is the JSON encoded value. <br /></td>
<td>null <br /><br />
{ “int” : 1 } <br /><br />
{ “float” : 3.5 } <br /><br />
{ “string” : “abc” } <br /><br />
{ “array” : { “s1”, “s2”, “s3” } } <br /><br />
{ “map” : { “key1” : 10, “key2” : 20, “key3” : 30 } } <br /><br />
{ “com.linkedin.generator.examples.Fruits” : “APPLE” }</td>
</tr>
</tbody>
</table>

<p>If a union schema has a typeref member, then the key for that member is
the dereferenced type. E.g. for union</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {
    "name" : "unionField",
    "type" : [
      "int",
      { "type" : "typeref", "name" : "a.b.c.d.Foo", "ref"  : "string" }
    ]
  }
</code></pre></div></div>

<p>the JSON encoding for the typeref member should look like</p>

<p><code class="highlighter-rouge">{ “string” : “Correct key” }</code></p>

<p>NOT</p>

<p><code class="highlighter-rouge">{ “a.b.c.d.Foo” : “Wrong key” }</code></p>

<p>Similarly, for a union with aliased members the key for the members will
be its corresponding alias. For example,</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {
    "name" : "unionField",
    "type" : [
      { "type" : "int", "alias" : "count" },
      { "type" : { "type" : "typeref", "name" : "a.b.c.d.Foo", "ref"  : "string" }, "alias" : "foo" }
    ]
  }
</code></pre></div></div>

<p>the JSON encoding for the typeref member should look like</p>

<p><code class="highlighter-rouge">{ “foo” : “Correct key” }</code></p>

<h5 id="how-to-serialize-data-to-json">How to serialize data to JSON</h5>

<p><code class="highlighter-rouge">DataMapUtils</code> provides convenience methods to serialize and deserialize
between data and JSON using <code class="highlighter-rouge">JacksonDataCodec</code>.</p>

<p>To serialize from a DataMap to JSON:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">DataMap</span> <span class="n">dataMap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DataMap</span><span class="o">();</span>
  <span class="n">dataMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"message"</span><span class="o">,</span> <span class="s">"Hi!"</span><span class="o">);</span>
  <span class="kt">byte</span><span class="o">[]</span> <span class="n">jsonBytes</span> <span class="o">=</span> <span class="n">DataMapUtils</span><span class="o">.</span><span class="na">mapToBytes</span><span class="o">(</span><span class="n">dataMap</span><span class="o">);</span>
  <span class="n">String</span> <span class="n">json</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">jsonBytes</span><span class="o">,</span> <span class="s">"UTF-8"</span><span class="o">);</span>

</code></pre></div></div>

<p>To serialize from a RecordTemplate instance to JSON:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">Greeting</span> <span class="n">greeting</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Greeting</span><span class="o">().</span><span class="na">setMessage</span><span class="o">(</span><span class="s">"Hi!"</span><span class="o">);</span> <span class="c1">// Where Greeting is class extending RecordTemplate</span>
  <span class="kt">byte</span><span class="o">[]</span> <span class="n">jsonBytes</span> <span class="o">=</span> <span class="n">DataMapUtils</span><span class="o">.</span><span class="na">dataTemplateToBytes</span><span class="o">(</span><span class="n">greeting</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
  <span class="n">String</span> <span class="n">json</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">jsonBytes</span><span class="o">,</span> <span class="s">"UTF-8"</span><span class="o">);</span>

</code></pre></div></div>

<h5 id="how-to-deserialize-json-to-data">How to Deserialize JSON to Data</h5>

<p>To deserialize from JSON to a DataMap:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">InputStream</span> <span class="n">in</span> <span class="o">=</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toInputStream</span><span class="o">(</span><span class="s">"{'message':'Hi!'}"</span><span class="o">);</span>
  <span class="n">DataMap</span> <span class="n">dataMap</span> <span class="o">=</span> <span class="n">DataMapUtils</span><span class="o">.</span><span class="na">readMap</span><span class="o">(</span><span class="n">in</span><span class="o">);</span>

</code></pre></div></div>

<p>To deserialize from JSON to a RecordTemplate:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">InputStream</span> <span class="n">in</span> <span class="o">=</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toInputStream</span><span class="o">(</span><span class="s">"{'message':'Hi!'}"</span><span class="o">);</span>
  <span class="n">Greeting</span> <span class="n">deserialized</span> <span class="o">=</span> <span class="n">DataMapUtils</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">in</span><span class="o">,</span> <span class="n">Greeting</span><span class="o">.</span><span class="na">class</span><span class="o">);</span> <span class="c1">// Where Greeting is class extending RecordTemplate</span>

</code></pre></div></div>

<h5 id="how-to-serialize-data-to-pson">How to Serialize Data to PSON</h5>

<p>PSON is a binary format that can represent any JSON data but is more
compact, requires less computation to serialize and deserialize, and can
transmit byte strings directly.</p>

<p>PSON serialization/deserialization works similar to JSON (as described
above) but uses these two methods:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  DataMapUtils.readMapPson()
  DataMapUtils.mapToPsonBytes()
</code></pre></div></div>

<h2 id="how-data-is-represented-in-memory">How Data is Represented in Memory</h2>

<p>There are three architectural layers that define how data is stored
in-memory and provide the API’s used to access this data.</p>

<ul>
  <li>The first layer is the Data layer. This is the storage layer and is
totally generic, for example, not schema aware.</li>
  <li>The second layer is the Data Schema layer. This layer provides the
in-memory representation of the data schema.</li>
  <li>The third layer is the Data Template layer. This layer provides Java
type-safe access to data stored by the Data layer.</li>
</ul>

<h3 id="the-data-layer">The Data Layer</h3>

<p>At the conceptual level, the Data layer provides generic in-memory
representations of JSON objects and arrays. A <code class="highlighter-rouge">DataMap</code> and a <code class="highlighter-rouge">DataList</code>
provide the in-memory representation of a JSON object and a JSON array
respectively. These DataMaps and DataLists are the primary in-memory
data structures that store and manage data belonging to instances of
complex schema types. This layer allows data to be serialized and
de-serialized into in-memory representations without requiring the
schema to be known. In fact, the Data layer is not aware of schemas and
do not require a schema to access the underlying data.</p>

<p>The main motivations behind the Data layer are:</p>

<ul>
  <li>To allow generic access to the underlying data for building generic
assembly and query engines. These engines need a generic data
representation to data access. Furthermore, they may need to
construct new instances from dynamically executed expressions, such
as joins and projections. The schema of these instances depend on
the expression executed, and could not be known in advance.</li>
  <li>To facilitate schema evolution. The Data layer enables “use what you
know and pass on what you don’t”. It allows new fields to be added
and passed through intermediate nodes in the service graph without
requiring these nodes to also have their schemas updated to include
these new fields.</li>
  <li>To permit some Java Virtual Machine service calls to be optimized by
avoiding serialization.</li>
</ul>

<h4 id="constraints">Constraints</h4>

<p>The Data layer implements the following constraints:</p>

<ul>
  <li>It permits only allowed types to be stored as values.</li>
  <li>All non-container values (not <code class="highlighter-rouge">DataMap</code> and not <code class="highlighter-rouge">DataList</code>) are
immutable.</li>
  <li>Null is not a value. The <code class="highlighter-rouge">Data.NULL</code> constant is used to represent
null deserialized from or to be serialized to JSON. Avoiding null
Java values reduces complexity by reducing the number of states a
field may have. Without null values, a field can have two states,
“absent” or “has valid value”. If null values are permitted, a
field can have three states, “absent”, “has null value”, and “has
valid value”.</li>
  <li>The object graph is always acyclic. The object graph is the graph of
objects connected by DataMaps and DataLists.</li>
  <li>The key type for a <code class="highlighter-rouge">DataMap</code> is always <code class="highlighter-rouge">java.lang.String</code>.</li>
</ul>

<h4 id="additional-features">Additional Features</h4>

<p>The Data layer provides the following additional features (above and
beyond what the Java library provides.)</p>

<ul>
  <li>A <code class="highlighter-rouge">DataMap</code> and <code class="highlighter-rouge">DataList</code> may be made read-only. Once it is
read-only, mutations will no longer be allowed and will throw
<code class="highlighter-rouge">java.lang.UnsupportedOperationException</code>. There is no way to revert
a read-only instance to read-write.</li>
  <li>Access instrumentation. See <code class="highlighter-rouge">com.linkedin.data.Instrumentable</code> for
details.</li>
  <li>Implements deep copy that should return a object graph that is
isomorphic with the source, i.e. the copy will retain the directed
acyclic graph structure of the source.</li>
</ul>

<h4 id="allowed-value-types">Allowed Value Types</h4>

<ul>
  <li><code class="highlighter-rouge">java.lang.Integer</code></li>
  <li><code class="highlighter-rouge">java.lang.Long</code></li>
  <li><code class="highlighter-rouge">java.lang.Float</code></li>
  <li><code class="highlighter-rouge">java.lang.Double</code></li>
  <li><code class="highlighter-rouge">java.lang.Boolean</code></li>
  <li><code class="highlighter-rouge">java.lang.String</code></li>
  <li><code class="highlighter-rouge">com.linkedin.data.ByteString</code></li>
  <li><code class="highlighter-rouge">com.linkedin.data.DataMap</code></li>
  <li><code class="highlighter-rouge">com.linkedin.data.DataList</code></li>
</ul>

<p>Note Enum types are not allowed because enum types are not generic and
portable. Enum values are stored as a string.</p>

<h4 id="datacomplex">DataComplex</h4>

<p>Both <code class="highlighter-rouge">DataMap</code> and <code class="highlighter-rouge">DataList</code> implement the
<code class="highlighter-rouge">com.linkedin.data.DataComplex</code> interface. This interface declares the
methods that supports the additional features common to a <code class="highlighter-rouge">DataMap</code> and
a <code class="highlighter-rouge">DataList</code>. These methods are:</p>

<table>
  <thead>
    <tr>
      <th>Method</th>
      <th>Declared by</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">DataComplex clone()</code></td>
      <td><code class="highlighter-rouge">DataComplex</code></td>
      <td>A shallow copy of the instance. <br />The read-only state is not copied, the clone will be mutable. <br />The instrumentation state is also not copied. <br />Although <code class="highlighter-rouge">java.lang.CloneNotSupportedException</code> is declared in the throws clause, the method should not throw this exception.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">DataComplex copy()</code> <br /></td>
      <td><code class="highlighter-rouge">DataComplex</code> <br /></td>
      <td>A deep copy of the object graph rooted at the instance. The copy will be isomorphic to the original. <br />The read-only state is not deep copied, and the new <code class="highlighter-rouge">DataComplex</code> copies will be mutable. <br />The instrumentation state is also not copied. <br />Although <code class="highlighter-rouge">java.lang.CloneNotSupportedException</code> is declared in the throws clause, the method should not throw this exception.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">void setReadOnly()</code> <br /></td>
      <td><code class="highlighter-rouge">CowCommon</code> <br /></td>
      <td>Make the instance read-only. It does not affect the read-only state of contained <code class="highlighter-rouge">DataComplex</code> values. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">boolean isReadOnly()</code> <br /></td>
      <td><code class="highlighter-rouge">CowCommon</code> <br /></td>
      <td>Whether the instance is in read-only state. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">void makeReadOnly()</code> <br /></td>
      <td><code class="highlighter-rouge">DataComplex</code> <br /></td>
      <td>Make the object graph rooted at this instance read-only. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">void isMadeReadOnly()</code> <br /></td>
      <td><code class="highlighter-rouge">DataComplex</code> <br /></td>
      <td>Whether the object graph rooted at this instance has been made read-only. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">Collection&lt;Object&gt; values()</code> <br /></td>
      <td><code class="highlighter-rouge">DataComplex</code> <br /></td>
      <td>Returns the values stored in the <code class="highlighter-rouge">DataComplex</code> instance, i.e. returns the values of a <code class="highlighter-rouge">DataMap</code> or the elements of a <code class="highlighter-rouge">DataList</code>. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">void startInstrumentatingAccess()</code> <br /></td>
      <td><code class="highlighter-rouge">Instrumentable</code> <br /></td>
      <td>Starts instrumenting access. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">void stopInstrumentingAccess()</code> <br /></td>
      <td><code class="highlighter-rouge">Instrumentable</code> <br /></td>
      <td>Stops instrumenting access. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">void clearInstrumentedData()</code> <br /></td>
      <td><code class="highlighter-rouge">Instrumentable</code> <br /></td>
      <td>Clears instrumentation data collected. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">void collectInstrumentedData(...)</code> <br /></td>
      <td><code class="highlighter-rouge">Instrumentable</code> <br /></td>
      <td>Collect data gathered when instrumentation was enabled. <br /></td>
    </tr>
  </tbody>
</table>

<p>Note: Details on <code class="highlighter-rouge">CowCommon</code>, <code class="highlighter-rouge">CowMap</code>, and <code class="highlighter-rouge">CowList</code> have been omitted
or covered under <code class="highlighter-rouge">DataComplex</code>. Cow provides copy-on-write
functionality. The semantics of <code class="highlighter-rouge">CowMap</code> and <code class="highlighter-rouge">CowList</code> is similar to
<code class="highlighter-rouge">HashMap</code> and <code class="highlighter-rouge">ArrayList</code>.</p>

<h4 id="datamap">DataMap</h4>

<p>The <code class="highlighter-rouge">com.linkedin.data.DataMap</code> class has the following characteristics:</p>

<ul>
  <li><code class="highlighter-rouge">DataMap</code> implements <code class="highlighter-rouge">java.util.Map&lt;String, Object&gt;</code>.</li>
  <li>Its <code class="highlighter-rouge">entrySet()</code>, <code class="highlighter-rouge">keySet()</code>, and <code class="highlighter-rouge">values()</code> methods return
unmodifiable set and collection views.</li>
  <li>Its <code class="highlighter-rouge">clone()</code> and <code class="highlighter-rouge">copy()</code> methods returns a <code class="highlighter-rouge">DataMap</code>.</li>
</ul>

<h4 id="datalist">DataList</h4>

<p>The <code class="highlighter-rouge">com.linkedin.data.DataList</code> class has the following
characteristics.</p>

<ul>
  <li><code class="highlighter-rouge">DataList</code> implements <code class="highlighter-rouge">java.util.List&lt;Object&gt;</code>.</li>
  <li>Its <code class="highlighter-rouge">clone()</code> and <code class="highlighter-rouge">copy()</code> method return a <code class="highlighter-rouge">DataList</code>.</li>
</ul>

<h3 id="the-data-schema-layer">The Data Schema Layer</h3>

<p>The Data Schema layer provides the in-memory representation of the data
schema. The Data Schema Layer provides the following main features:</p>

<ul>
  <li>Parse a JSON encoded schema into in-memory representation using
classes in this layer</li>
  <li>Validate a Data object against a schema</li>
</ul>

<p>Their common base class for Data Schema classes is
<code class="highlighter-rouge">com.linkedin.data.schema.DataSchema</code>. It defines the following methods:</p>

<table>
  <thead>
    <tr>
      <th>Method</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">Type getType()</code> <br /></td>
      <td>Provide the type of the schema, can be <code class="highlighter-rouge">BOOLEAN</code>, <code class="highlighter-rouge">INT</code>, <code class="highlighter-rouge">LONG</code>, <code class="highlighter-rouge">FLOAT</code>, <code class="highlighter-rouge">DOUBLE</code>, <code class="highlighter-rouge">BYTES</code>, <code class="highlighter-rouge">STRING</code>, <code class="highlighter-rouge">FIXED</code>, <code class="highlighter-rouge">ENUM</code>, <code class="highlighter-rouge">NULL</code>, <code class="highlighter-rouge">ARRAY</code>, <code class="highlighter-rouge">RECORD</code>, <code class="highlighter-rouge">MAP</code>, <code class="highlighter-rouge">UNION</code>. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">boolean hasError()</code> <br /></td>
      <td>Whether the schema definition contains at least one error. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">boolean isPrimitive()</code> <br /></td>
      <td>Whether the schema type is a primitive schema type. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">boolean isComplex()</code> <br /></td>
      <td>Whether the schema type is a complex schema type, i.e. not primitive type. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">Map&lt;String,Object&gt; getProperties()</code> <br /></td>
      <td>Return the properties of the schema. These properties are the keys and values from the JSON fields in complex schema definitions that are not processed and interpreted by the schema parser. For primitive types, this method always return an immutable empty map. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">String getUnionMemberKey()</code> <br /></td>
      <td>If this type is used as a member of a union without an alias, this will be the key that uniquely identifies/selects this type within the union. This value of this key is as defined by the Avro 1.4.1 specification for JSON serialization. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">String toString()</code> <br /></td>
      <td>A more human consumable formatting of the schema in JSON encoding. Space will added between fields, items, names, values, … etc. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">Type getDereferencedType</code> <br /></td>
      <td>If the type is a typeref, it will follow the typeref reference chain and return the type referenced at the end of the typeref chain. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">DataSchema getDereferencedSchema</code> <br /></td>
      <td>If the type is a typeref, it will follow the typeref reference chain and return the DataSchema referenced at the end of the typeref chain. <br /></td>
    </tr>
  </tbody>
</table>

<p>The following table shows the mapping of schema types to Data Schema
classes.</p>

<table>
  <thead>
    <tr>
      <th>Schema Type <br /></th>
      <th>Data Schema class <br /></th>
      <th>Relevant Specific Attributes <br /></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>int <br /></td>
      <td><code class="highlighter-rouge">IntegerDataSchema</code> <br /></td>
      <td> </td>
    </tr>
    <tr>
      <td>long <br /></td>
      <td><code class="highlighter-rouge">LongDataSchema</code> <br /></td>
      <td> </td>
    </tr>
    <tr>
      <td>float <br /></td>
      <td><code class="highlighter-rouge">FloatDataSchema</code> <br /></td>
      <td> </td>
    </tr>
    <tr>
      <td>double <br /></td>
      <td><code class="highlighter-rouge">DoubleDataSchema</code> <br /></td>
      <td> </td>
    </tr>
    <tr>
      <td>boolean <br /></td>
      <td><code class="highlighter-rouge">BooleanDataSchema</code> <br /></td>
      <td> </td>
    </tr>
    <tr>
      <td>string <br /></td>
      <td><code class="highlighter-rouge">StringDataSchema</code> <br /></td>
      <td> </td>
    </tr>
    <tr>
      <td>bytes <br /></td>
      <td><code class="highlighter-rouge">BytesDataSchema</code> <br /></td>
      <td> </td>
    </tr>
    <tr>
      <td>enum <br /></td>
      <td><code class="highlighter-rouge">EnumDataSchema</code> <br /></td>
      <td><code class="highlighter-rouge">List&lt;String&gt; getSymbols()</code> <br /><code class="highlighter-rouge">int index(String symbol)</code> <br /><code class="highlighter-rouge">boolean contains(String symbol)</code> <br /></td>
    </tr>
    <tr>
      <td>array <br /></td>
      <td><code class="highlighter-rouge">ArrayDataSchema</code> <br /></td>
      <td><code class="highlighter-rouge">DataSchema getItems()</code> <br /></td>
    </tr>
    <tr>
      <td>map <br /></td>
      <td><code class="highlighter-rouge">MapDataSchema</code> <br /></td>
      <td><code class="highlighter-rouge">DataSchema getValues()</code></td>
    </tr>
    <tr>
      <td>fixed <br /></td>
      <td><code class="highlighter-rouge">FixedDataSchema</code> <br /></td>
      <td><code class="highlighter-rouge">int getSize()</code> <br /></td>
    </tr>
    <tr>
      <td>record, error <br /></td>
      <td><code class="highlighter-rouge">RecordDataSchema</code> <br /></td>
      <td><code class="highlighter-rouge">RecordType recordType()</code> (record or error) <br /><code class="highlighter-rouge">boolean isErrorRecord()</code> <br /><code class="highlighter-rouge">List&lt;Field&gt; getFields()</code> <br /><code class="highlighter-rouge">int index(String fieldName)</code> <br /><code class="highlighter-rouge">boolean contains(String fieldName)</code> <br /><code class="highlighter-rouge">Field getField(String fieldName)</code> <br /></td>
    </tr>
    <tr>
      <td>union <br /></td>
      <td><code class="highlighter-rouge">UnionDataSchema</code> <br /></td>
      <td><code class="highlighter-rouge">List&lt;Member&gt; getMembers()</code> <br /><code class="highlighter-rouge">boolean contains(String memberKey)</code> <br /><code class="highlighter-rouge">DataSchema getTypeByMemberKey(String memberKey)</code> <br /><code class="highlighter-rouge">boolean areMembersAliased()</code> <br /></td>
    </tr>
    <tr>
      <td>null <br /></td>
      <td><code class="highlighter-rouge">NullDataSchema</code> <br /></td>
      <td> </td>
    </tr>
  </tbody>
</table>

<h3 id="data-to-schema-validation">Data to Schema Validation</h3>

<p>The <code class="highlighter-rouge">ValidateDataAgainstSchema</code> class provides methods for validating
Data layer instances with a Data Schema. The <code class="highlighter-rouge">ValidationOption</code> class is
used to specify how validation should be performed and how to fix-up the
input Data layer objects to conform to the schema. There are two
independently configuration options:</p>

<ul>
  <li><code class="highlighter-rouge">RequiredMode</code> option indicates how required fields should be
handled during validation.</li>
  <li><code class="highlighter-rouge">CoercionMode</code> option indicates how to coerce Data layer objects to
the Java type corresponding to their schema type.</li>
</ul>

<p>Example Usage:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">ValidationResult</span> <span class="n">validationResult</span> <span class="o">=</span>
  <span class="n">ValidateDataAgainstSchema</span><span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="n">dataTemplate</span><span class="o">,</span> <span class="n">dataTemplate</span><span class="o">.</span><span class="na">schema</span><span class="o">(),</span>
  <span class="k">new</span> <span class="nf">ValidationOptions</span><span class="o">());</span>  
  <span class="k">if</span> <span class="o">(!</span><span class="n">validationResult</span><span class="o">.</span><span class="na">isValid</span><span class="o">())</span>  
  <span class="o">{</span>  
  <span class="c1">// do something  </span>
  <span class="o">}</span>  
</code></pre></div></div>

<h4 id="requiredmode">RequiredMode</h4>

<p>The available RequiredModes are:</p>

<ul>
  <li><code class="highlighter-rouge">IGNORE</code><br />
Required fields may be absent. Do not indicate a validation error if
a required field is absent.</li>
  <li><code class="highlighter-rouge">MUST_BE_PRESENT</code><br />
If a required field is absent, then validation fails. Validation
will fail even if the required field has been declared with a
default value.</li>
  <li><code class="highlighter-rouge">CAN_BE_ABSENT_IF_HAS_DEFAULT</code><br />
If a required field is absent and the field has not been declared
with a default value, then validation fails. Validation will not
attempt to modify the field to provide it with the default value.</li>
  <li><code class="highlighter-rouge">FIXUP_ABSENT_WITH_DEFAULT</code><br />
If a required field is absent and it cannot be fixed-up with a
default value, then validation fails.<br />
This mode will attempt to modify an absent field to provide it with
the field’s default value.<br />
If the field does not have a default value, validation fails.<br />
If the field has a default value, validation will attempt to set the
field’s value to the default value.<br />
This attempt may fail if fixup is not enabled or the <code class="highlighter-rouge">DataMap</code>
containing the field cannot be modified because it is read-only.<br />
The provided default value will be read-only.</li>
</ul>

<h4 id="coercionmode">CoercionMode</h4>

<p>Since JSON does not have or encode enough information on the actual
types of primitives, and schema types like bytes and fixed are not
represented by native types in JSON, the initial de-serialized in-memory
representation of instances of these types may not be the actual type
specified in the schema. For example, when de-serializing the number 52,
it will be de-serialized into an <code class="highlighter-rouge">Integer</code> even though the schema type
may be a <code class="highlighter-rouge">Long</code>. This is because a schema is not required to serialize
or de-serialize.</p>

<p>When the data is accessed via schema aware language binding like the
Java binding, the conversion/coercion can occur at the language binding
layer. In cases when the language binding is not used, it may be
desirable to fix-up a Data layer object by coercing it the Java type
corresponding to the object’s schema. For example, the appropriate Java
type the above example would be a <code class="highlighter-rouge">Long</code>. Another fix-up would be to
fixup Avro-specified string encoding of binary data (bytes or fixed)
into a <code class="highlighter-rouge">ByteString</code>. In another case, it may be desirable to coerce the
string representation of a value to the Java type corresponding to the
object’s schema. For example, coerce “65” to 65, the integer, if the
schema type is “int”.</p>

<p>Whether an how coercion is performed is specified by <code class="highlighter-rouge">CoercionMode</code>. The
available CoercionModes are:</p>

<ul>
  <li><code class="highlighter-rouge">OFF</code><br />
No coercion is performed.</li>
  <li><code class="highlighter-rouge">NORMAL</code><br />
Numeric types are coerced to the schema’s corresponding Java numeric
type. Avro-encoded binary strings are coerced to ByteString if the
schema type is bytes or fixed.</li>
  <li><code class="highlighter-rouge">STRING_TO_PRIMITIVE</code><br />
Includes all the coercions performed by <code class="highlighter-rouge">NORMAL</code>. In addition, also
coerces string representations of numbers to the schema’s
corresponding numeric type, and string representation of booleans
(“true” or “false” case-insenstive) to <code class="highlighter-rouge">Boolean</code>.</li>
</ul>

<p><a name="NormalMode"></a></p>

<h5 id="normal-coercion-mode"><code class="highlighter-rouge">NORMAL</code> Coercion Mode</h5>

<p>The following table provides additional details on the <code class="highlighter-rouge">NORMAL</code>
validation and coercion mode.</p>

<table>
  <thead>
    <tr>
      <th>Schema Type <br /></th>
      <th>Post-coercion Java Type <br /></th>
      <th>Pre-coercion Input Java Types <br /></th>
      <th>Validation Performed <br /></th>
      <th>Coercion Method</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>int <br /></td>
      <td><code class="highlighter-rouge">java.lang.Integer</code> <br /></td>
      <td><code class="highlighter-rouge">java.lang.Number</code> (1) <br /></td>
      <td>Value must be a <code class="highlighter-rouge">Number</code>. <br /></td>
      <td><code class="highlighter-rouge">Number.intValue()</code> <br /></td>
    </tr>
    <tr>
      <td>long <br /></td>
      <td><code class="highlighter-rouge">java.lang.Long</code> <br /></td>
      <td><code class="highlighter-rouge">java.lang.Number</code> (1)</td>
      <td>Value must be a <code class="highlighter-rouge">Number</code>. <br /></td>
      <td><code class="highlighter-rouge">Number.longValue()</code> <br /></td>
    </tr>
    <tr>
      <td>float <br /></td>
      <td><code class="highlighter-rouge">java.lang.Float</code> <br /></td>
      <td><code class="highlighter-rouge">java.lang.Number</code> (1)</td>
      <td>Value must be a <code class="highlighter-rouge">Number</code>.</td>
      <td><code class="highlighter-rouge">Number.floatValue()</code> <br /></td>
    </tr>
    <tr>
      <td>double <br /></td>
      <td><code class="highlighter-rouge">java.lang.Double</code> <br /></td>
      <td><code class="highlighter-rouge">java.lang.Number</code> (1)</td>
      <td>Value must be a <code class="highlighter-rouge">Number</code>.</td>
      <td><code class="highlighter-rouge">Number.doubleValue()</code> <br /></td>
    </tr>
    <tr>
      <td>boolean <br /></td>
      <td><code class="highlighter-rouge">java.lang.Boolean</code> <br /></td>
      <td><code class="highlighter-rouge">java.lang.Boolean</code> (2) <br /></td>
      <td>Value must be a <code class="highlighter-rouge">Boolean</code>. <br /></td>
      <td> </td>
    </tr>
    <tr>
      <td>string <br /></td>
      <td><code class="highlighter-rouge">java.lang.String</code> <br /></td>
      <td><code class="highlighter-rouge">java.lang.String</code> (2) <br /></td>
      <td>Value must be a <code class="highlighter-rouge">String</code>. <br /></td>
      <td> </td>
    </tr>
    <tr>
      <td>bytes <br /></td>
      <td><code class="highlighter-rouge">com.linkedin.data.ByteString</code> <br /></td>
      <td><code class="highlighter-rouge">com.linkedin.data.ByteString</code>, <code class="highlighter-rouge">java.lang.String</code> (3) <br /></td>
      <td>If the value is a <code class="highlighter-rouge">String</code>, the <code class="highlighter-rouge">String</code> must be a valid encoding of binary data as specified by the Avro specification for encoding bytes into a JSON string. <br /></td>
      <td><code class="highlighter-rouge">ByteString.copyFromAvroString()</code> <br /></td>
    </tr>
    <tr>
      <td>enum <br /></td>
      <td><code class="highlighter-rouge">java.lang.String</code> <br /></td>
      <td><code class="highlighter-rouge">java.lang.String</code> <br /></td>
      <td>The value must be a symbol defined by the enum schema. <br /></td>
      <td> </td>
    </tr>
    <tr>
      <td>array <br /></td>
      <td><code class="highlighter-rouge">com.linkedin.data.DataList</code> <br /></td>
      <td><code class="highlighter-rouge">com.linkedin.data.DataList</code> (2) <br /></td>
      <td>Each element in the <code class="highlighter-rouge">DataList</code> must be a valid Java type for the schema’s item type. For example, if the schema is an array of longs, then every element in the <code class="highlighter-rouge">DataList</code> must be a <code class="highlighter-rouge">Number</code>. <br /></td>
      <td> </td>
    </tr>
    <tr>
      <td>map <br /></td>
      <td><code class="highlighter-rouge">com.linkedin.data.DataMap</code> <br /></td>
      <td><code class="highlighter-rouge">com.linkedin.data.DataMap</code> (2) <br /></td>
      <td>Each value in the <code class="highlighter-rouge">DataMap</code> must be a valid Java type for the schema’s value type. For example, if the schema is a map of longs, then every value in the <code class="highlighter-rouge">DataMap</code> must be a <code class="highlighter-rouge">Number</code>.</td>
      <td> </td>
    </tr>
    <tr>
      <td>fixed <br /></td>
      <td><code class="highlighter-rouge">com.linkedin.data.ByteString</code> <br /></td>
      <td><code class="highlighter-rouge">com.linked.data.ByteString</code> (2), <code class="highlighter-rouge">java.lang.String</code> (3) <br /></td>
      <td>If the value is a <code class="highlighter-rouge">String</code>, the <code class="highlighter-rouge">String</code> must be a valid encoding of binary data as specified by the Avro specification for encoding bytes into a JSON string and the correct size for the fixed schema type. <br />If the value is a <code class="highlighter-rouge">ByteString</code>, the <code class="highlighter-rouge">ByteString</code> must be the correct size for the fixed schema type. <br /></td>
      <td><code class="highlighter-rouge">ByteString.copyFromAvroString()</code></td>
    </tr>
    <tr>
      <td>record <br /></td>
      <td><code class="highlighter-rouge">com.linkedin.data.DataMap</code> <br /></td>
      <td><code class="highlighter-rouge">com.linkedin.data.DataMap</code> (2) <br /></td>
      <td>Each key in the <code class="highlighter-rouge">DataMap</code> will be used lookup a field in the record schema. The value associated with this key must be a valid Java type for the field’s type. <br />If the required validation option is enabled, then all required fields must also be present. <br /></td>
      <td> </td>
    </tr>
    <tr>
      <td>union <br /></td>
      <td><code class="highlighter-rouge">com.linkedin.data.DataMap</code> <br /></td>
      <td><code class="highlighter-rouge">java.lang.String</code>, <code class="highlighter-rouge">com.linkedin.data.DataMap</code> (2) <br /></td>
      <td>f the value is a <code class="highlighter-rouge">String</code>, the value must be <code class="highlighter-rouge">Data.NULL</code>. <br />If the value is a <code class="highlighter-rouge">DataMap</code>, then the <code class="highlighter-rouge">DataMap</code> must have exactly one entry. The key of the entry must identify a member of the union schema, and the value must be a valid type for the identified union member’s type. <br /></td>
      <td> </td>
    </tr>
  </tbody>
</table>

<p>(1) Even though <code class="highlighter-rouge">Number</code> type is allowed and used for fixing up to the
desired type, the Data layer only allows <code class="highlighter-rouge">Integer</code>, <code class="highlighter-rouge">Long</code>, <code class="highlighter-rouge">Float</code>, and
<code class="highlighter-rouge">Double</code> values to be held in a <code class="highlighter-rouge">DataMap</code> or <code class="highlighter-rouge">DataList</code>.<br />
(2) No fix-up is performed.<br />
(3) the <code class="highlighter-rouge">String</code> must be a valid encoding of binary data as specified by
the Avro specification for encoding bytes into a JSON string.</p>

<h5 id="string_to_primitive-coercion-mode"><code class="highlighter-rouge">STRING_TO_PRIMITIVE</code> Coercion Mode</h5>

<p>This mode includes allowed input types and associated validation and
coercion’s of <code class="highlighter-rouge">NORMAL</code>. In addition, it allows the following additional
input types and performs the following coercions on these additional
allowed input types.</p>

<table>
  <thead>
    <tr>
      <th>Schema Type <br /></th>
      <th>Post-coercion Java Type <br /></th>
      <th>Pre-coercion Input Java Types <br /></th>
      <th>Validation Performed <br /></th>
      <th>_. Coercion Method <br /></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>int <br /></td>
      <td><code class="highlighter-rouge">java.lang.Integer</code> <br /></td>
      <td><code class="highlighter-rouge">java.lang.String</code> <br /></td>
      <td>If value is a <code class="highlighter-rouge">String</code>, it must be acceptable to <code class="highlighter-rouge">BigDecimal(String val)</code>, else it has to be a <code class="highlighter-rouge">Number</code> (see “<a href="#normal-coercion-mode"><code class="highlighter-rouge">NORMAL</code></a>”) <br /></td>
      <td><code class="highlighter-rouge">(new BigDecimal(value)).intValue()</code> <br /></td>
    </tr>
    <tr>
      <td>long <br /></td>
      <td><code class="highlighter-rouge">java.lang.Long</code> <br /></td>
      <td><code class="highlighter-rouge">java.lang.String</code></td>
      <td>If value is a <code class="highlighter-rouge">String</code>, it must be acceptable to <code class="highlighter-rouge">BigDecimal(String val)</code>, else it has to be a <code class="highlighter-rouge">Number</code> (see “<a href="#normal-coercion-mode"><code class="highlighter-rouge">NORMAL</code></a>”)</td>
      <td><code class="highlighter-rouge">(new BigDecimal(value)).longValue()</code></td>
    </tr>
    <tr>
      <td>float <br /></td>
      <td><code class="highlighter-rouge">java.lang.Float</code> <br /></td>
      <td><code class="highlighter-rouge">java.lang.String</code></td>
      <td>If value is a <code class="highlighter-rouge">String</code>, it must be acceptable to <code class="highlighter-rouge">BigDecimal(String val)</code>, else it has to be a <code class="highlighter-rouge">Number</code> (see “<a href="#normal-coercion-mode"><code class="highlighter-rouge">NORMAL</code></a>”) <br /></td>
      <td><code class="highlighter-rouge">(new BigDecimal(value)).floatValue()</code></td>
    </tr>
    <tr>
      <td>double <br /></td>
      <td><code class="highlighter-rouge">java.lang.Double</code> <br /></td>
      <td><code class="highlighter-rouge">java.lang.String</code></td>
      <td>If value is a <code class="highlighter-rouge">String</code>, it must be acceptable to <code class="highlighter-rouge">BigDecimal(String val)</code>, else it has to be a <code class="highlighter-rouge">Number</code> (see “<a href="#normal-coercion-mode"><code class="highlighter-rouge">NORMAL</code></a>”) <br /></td>
      <td><code class="highlighter-rouge">(new BigDecimal(value)).doubleValue()</code></td>
    </tr>
    <tr>
      <td>boolean <br /></td>
      <td><code class="highlighter-rouge">java.lang.Boolean</code> <br /></td>
      <td><code class="highlighter-rouge">java.lang.String</code></td>
      <td>if value is a <code class="highlighter-rouge">String</code>, its value must be either <code class="highlighter-rouge">"true"</code> or <code class="highlighter-rouge">"false"</code> ignoring case, else it has to be a <code class="highlighter-rouge">Boolean</code> (see “<a href="#normal-coercion-mode"><code class="highlighter-rouge">NORMAL</code></a>”) <br /></td>
      <td>&lt;pre&gt;<code>if ("true".equalsIgnoreCase(value))<br /> return Boolean.TRUE;<br />else if ("false".equalsIgnoreCase(value))<br />  return Boolean.FALSE;<br />else <br />  // invalid string representation<br />  // of boolean </code>&lt;/pre&gt;</td>
    </tr>
  </tbody>
</table>

<h4 id="validationresult">ValidationResult</h4>

<p>The result of validation is returned through an instance of the
<code class="highlighter-rouge">ValidationResult</code> class. This class has the following methods:</p>

<table>
  <thead>
    <tr>
      <th>Method</th>
      <th>Description <br /></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">boolean hasFix()</code> <br /></td>
      <td>Whether any fix-ups (i.e., modification or replacement of input Data layer objects) have been proposed. Fixes may be proposed but not applied because fixes cannot be applied to read-only complex objects. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">boolean hasFixupReadOnlyError()</code> <br /></td>
      <td>Whether any fix-ups could not be applied because of read-only complex objects. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">Object getFixed()</code> <br /></td>
      <td>Return a fixed object. In-place fixes may or may not be possible because some objects are immutable. For example, if the schema type is “fixed” and String object is provided as the Data object, the fixed-up object that would be returned will be a ByteString. Since String and ByteString are both immutable and have different types, the fixed object will be a different object, i.e. the fix-up cannot be done in-place. <br /><br />For complex objects, the fix-ups can be applied in place. This is because the new values can replace the old values in a <code class="highlighter-rouge">DataMap</code> or <code class="highlighter-rouge">DataList</code>. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">boolean isValid()</code> <br /></td>
      <td>Whether the fixed object returns by <code class="highlighter-rouge">getFixed()</code> contains any errors. If it returns <code class="highlighter-rouge">false</code>, then the fixed object and its dependents are fixed up according to the provided schema. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">String getMessage()</code> <br /></td>
      <td>Provides details on validation and fix-up failures. Returns empty string if <code class="highlighter-rouge">isValid()</code> is <code class="highlighter-rouge">true</code> and fix-ups/validation have occurred without problems. <br /></td>
    </tr>
  </tbody>
</table>

<p>Note: Schema validation and coercion are currently explicit operations.
They are not implicitly performed when data are de-serialized as part of
remote invocations.</p>

<h3 id="the-data-template-layer">The Data Template Layer</h3>

<p>The Data Template layer provides Java type-safe access to the underlying
data stored in the Data layer. It has explicit knowledge of the schema
of the data stored. The code generator generates classes for complex
schema types that derive from base classes in this layer. The common
base of these generated is <code class="highlighter-rouge">com.linkedin.data.DataTemplate</code>. Typically,
a <code class="highlighter-rouge">DataTemplate</code> instance is an overlay or wrapper for a <code class="highlighter-rouge">DataMap</code> or
<code class="highlighter-rouge">DataList</code> instance. It allows type-safe access to the underlying data
in the <code class="highlighter-rouge">DataMap</code> or <code class="highlighter-rouge">DataList</code>. (The exception is the <code class="highlighter-rouge">FixedTemplate</code>
which is a subclass of <code class="highlighter-rouge">DataTemplate</code> for fixed schema types.)</p>

<p>The Data Template layer provides the following abstract base classes
that are used to construct Java bindings for different complex schema
types.</p>

<table>
  <thead>
    <tr>
      <th>Class</th>
      <th>Underlying Data <br /></th>
      <th>Description <br /></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">AbstractArrayTemplate</code> <br /></td>
      <td><code class="highlighter-rouge">DataList</code> <br /></td>
      <td>Base class for array types. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">DirectArrayTemplate</code> <br /></td>
      <td><code class="highlighter-rouge">DataList</code> <br /></td>
      <td>Base class for array types containing unwrapped item types, extends <code class="highlighter-rouge">AbstractArrayTemplate</code>. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">WrappingArrayTemplate</code> <br /></td>
      <td><code class="highlighter-rouge">DataList</code> <br /></td>
      <td>Base class for array types containing wrapped item types, extends <code class="highlighter-rouge">AbstractArrayTemplate</code>. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">AbstractMapTemplate</code> <br /></td>
      <td><code class="highlighter-rouge">DataMap</code> <br /></td>
      <td>Base class for map types. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">DirectMapTemplate</code> <br /></td>
      <td><code class="highlighter-rouge">DataMap</code> <br /></td>
      <td>Base class for map types containing unwrapped value types, extends <code class="highlighter-rouge">AbstractMapTemplate</code>. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">WrappingMapTemplate</code> <br /></td>
      <td><code class="highlighter-rouge">DataMap</code> <br /></td>
      <td>Base class for map types containing wrapped value types, extends <code class="highlighter-rouge">AbstractMapTemplate</code>. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">FixedTemplate</code> <br /></td>
      <td><code class="highlighter-rouge">ByteString</code> <br /></td>
      <td>Base class for fixed types. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">RecordTemplate</code> <br /></td>
      <td><code class="highlighter-rouge">DataMap</code> <br /></td>
      <td>Base class for record types. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">ExceptionTemplate</code> <br /></td>
      <td><code class="highlighter-rouge">DataMap</code> <br /></td>
      <td>Base class for record types that declared as errors. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">UnionTemplate</code> <br /></td>
      <td><code class="highlighter-rouge">DataMap</code> <br /></td>
      <td>Base class for union types. <br /></td>
    </tr>
  </tbody>
</table>

<p>The unwrapped schema types are:</p>

<ul>
  <li>int</li>
  <li>long</li>
  <li>float</li>
  <li>double</li>
  <li>boolean</li>
  <li>string</li>
  <li>bytes</li>
  <li>enum</li>
</ul>

<p>The wrapped schema types are types whose Java type-safe bindings are not
the same as their data type in the Data layer. These types require a
<code class="highlighter-rouge">DataTemplate</code> wrapper to provide type-safe access to the underlying
data managed by the Data layer. The wrapped types are:</p>

<ul>
  <li>array</li>
  <li>map</li>
  <li>fixed</li>
  <li>record and error</li>
  <li>union</li>
</ul>

<p><code class="highlighter-rouge">Enum</code> is an unwrapped type even though its Java type-safe binding is
not the same as its storage type in the Data layer. This is because enum
conversions are done through coercing to and from <code class="highlighter-rouge">java.lang.String</code> s
implemented by the Data Template layer. This is similar to coercing
between different numeric types also implemented by the Data Template
layer.</p>

<p>The following table shows the relationships among types defined in the
data schema, types stored and managed by the Data layer, and the types
of the Java binding in the Data Template
layer.</p>

<table>
  <thead>
    <tr>
      <th>Schema Type <br /></th>
      <th>Data Layer <br /></th>
      <th>Data Template Layer <br /></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>int <br /></td>
      <td><code class="highlighter-rouge">java.lang.Integer</code> <br /></td>
      <td>Coerced to <code class="highlighter-rouge">java.lang.Integer</code> or <code class="highlighter-rouge">int</code> (2) <br /></td>
    </tr>
    <tr>
      <td>long <br /></td>
      <td><code class="highlighter-rouge">java.lang.Integer</code> or <code class="highlighter-rouge">java.lang.Long</code> (1) <br /></td>
      <td>Coerced to <code class="highlighter-rouge">java.lang.Long</code> or <code class="highlighter-rouge">long</code> (2) <br /></td>
    </tr>
    <tr>
      <td>float <br /></td>
      <td><code class="highlighter-rouge">java.lang.Integer</code>, <code class="highlighter-rouge">java.lang.Long</code>, <code class="highlighter-rouge">java.lang.Float</code> or <code class="highlighter-rouge">java.lang.Double</code> (1) <br /></td>
      <td>Coerced to <code class="highlighter-rouge">java.lang.Float</code> or <code class="highlighter-rouge">float</code> (2) <br /></td>
    </tr>
    <tr>
      <td>double <br /></td>
      <td><code class="highlighter-rouge">java.lang.Integer</code>, <code class="highlighter-rouge">java.lang.Long</code>, <code class="highlighter-rouge">java.lang.Float</code> or <code class="highlighter-rouge">java.lang.Double</code> (1) <br /></td>
      <td>Coerced to <code class="highlighter-rouge">java.lang.Double</code> or <code class="highlighter-rouge">double</code> (2) <br /></td>
    </tr>
    <tr>
      <td>boolean <br /></td>
      <td><code class="highlighter-rouge">java.lang.Boolean</code> <br /></td>
      <td>Coerced to <code class="highlighter-rouge">java.lang.Boolean</code> or <code class="highlighter-rouge">boolean</code> (2) <br /></td>
    </tr>
    <tr>
      <td>string <br /></td>
      <td><code class="highlighter-rouge">java.lang.String</code> <br /></td>
      <td><code class="highlighter-rouge">java.lang.String</code> <br /></td>
    </tr>
    <tr>
      <td>bytes <br /></td>
      <td><code class="highlighter-rouge">java.lang.String</code> or <code class="highlighter-rouge">com.linkedin.data.ByteString</code> (3) <br /></td>
      <td><code class="highlighter-rouge">com.linkedin.data.ByteString</code> <br /></td>
    </tr>
    <tr>
      <td>enum <br /></td>
      <td><code class="highlighter-rouge">java.lang.String</code> <br /></td>
      <td>Generated enum class. <br /></td>
    </tr>
    <tr>
      <td>array <br /></td>
      <td><code class="highlighter-rouge">com.linkedin.data.DataList</code> <br /></td>
      <td>Generated or built-in array class. <br /></td>
    </tr>
    <tr>
      <td>map <br /></td>
      <td><code class="highlighter-rouge">com.linkedin.data.DataMap</code> <br /></td>
      <td>Generated or built-in map class. <br /></td>
    </tr>
    <tr>
      <td>fixed <br /></td>
      <td><code class="highlighter-rouge">java.lang.String</code> or <code class="highlighter-rouge">com.linkedin.data.ByteString</code> <br /></td>
      <td>Generated class that derives from <code class="highlighter-rouge">FixedTemplate</code> <br /></td>
    </tr>
    <tr>
      <td>record <br /></td>
      <td><code class="highlighter-rouge">com.linkedin.data.DataMap</code> <br /></td>
      <td>Generated class that derives from <code class="highlighter-rouge">RecordTemplate</code> <br /></td>
    </tr>
    <tr>
      <td>error <br /></td>
      <td><code class="highlighter-rouge">com.linkedin.data.DataMap</code> <br /></td>
      <td>Generated class that derives from <code class="highlighter-rouge">ExceptionTemplate</code> <br /></td>
    </tr>
    <tr>
      <td>union <br /></td>
      <td><code class="highlighter-rouge">com.linkedin.data.DataMap</code> <br /></td>
      <td>Generated class that derives from <code class="highlighter-rouge">UnionTemplate</code> <br /></td>
    </tr>
  </tbody>
</table>

<p>(1) When a JSON object is deserialized, the actual schema type is not
known. Typically, the smallest sized type that can represent the
deserialized value will be used to store the value in-memory.<br />
(2) Depending on the method, un-boxed types will be preferred to boxed
types if applicable and the input or output arguments can never be
null.<br />
(3) When a JSON object is deserialized, the actual schema type is not
known for bytes and fixed. Values of bytes and fixed types are stored as
strings as serialized representation is a string. However, <code class="highlighter-rouge">ByteString</code>
is an equally valid Java type for these schema types.</p>

<h2 id="java-binding">Java Binding</h2>

<p>This section describes the details of the Java classes (dataModels)
generated by the code generator. These bindings are built on the classes
provided by the Data Template layer described above.</p>

<h3 id="package-and-class-names">Package and Class Names</h3>

<p>The Java binding determines the package and class names of the generated
and/or built-in classes using the following rules.</p>

<table>
<thead>
<tr class="header">
<th>Schema Type <br /></th>
<th>Java Package and Class Name<br /></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>
maps and arrays of primitive types
</td>
<td>
Package name is <code>com.linkedin.data.template</code>. <br />
Class name is computed by appending "Map" or "Array" to the corresponding boxed type's class name. <br />
For multi-dimensional maps and arrays, a "Map" or "Array" is appended for each dimension starting with the inner most dimension first. <br />
<br />
<b>Example Schema</b><pre><code>
{ "type" : "map", "values" : "boolean" }
{ "type" : "array", "items" : { "type" : "map" : "values" : "string" } }
</code></pre>
<b>Java package and class</b><pre><code>
package com.linkedin.data.template;
public class BooleanMap extends DirectArrayTemplate&amp;ltBoolean&amp;gt ...
public class StringMapArray extends DirectArrayTemplate&amp;ltStringMap&amp;gt ...
</code></pre>
</td>
</tr>
<tr class="even">
<td>
enum, fixed, record types <br /> (named schema types)
</td>
<td>
Package name is the package of the named schema type if it is specified, otherwise package name will use the namespace of the named schema type by default. <br />
Class name is the name of the named schema type. <br />
<br />
<b>Example Schema</b> 
<pre><code>
{ "type" : "record", "name" : "a.b.c.d.Foo", "fields" : ... }
{ "type" : "enum", "name" : "Bar", "namespace" : "x.y.z", "package": "x.y.z.test", symbols" : ... }
</code></pre>
<b>Java package and class</b>
<pre><code>
package a.b.c.d;
public class Foo extends RecordTemplate ...
<br />
package x.y.z.test;
public enum class Bar ...
</code></pre>
</td>
</tr>
<tr class="odd">
<td>
maps and arrays of enum, fixed, record <br />
(maps and arrays of named schema types) <br />
</td>
<td>
Package name is the package name of the named schema type, which follows the rule documented in this table for named schema. <br />
Class name is computed by appending "Map" or "Array" to name of generated class for the named schema type. <br />
For multi-dimensional maps and arrays, a "Map" or "Array" is appended for each dimension starting with the inner most dimension first. <br />
<br />
<b>Example Schema</b> 
<pre><code>
{ "type" : "map", "values" : "a.b.c.d.Foo" }
{ "type" : "map", "values" : { "type" : "array", "items" : "a.b.c.d.Foo" } }
<br />
{ "type" : "array", "items" : "x.y.z.Bar" }
{ "type" : "array", "items" : { "type" : "map", "values" : "x.y.z.Bar" } }
</code></pre>

<b>Java package and class</b> 
<pre><code>
package a.b.c.d;
 
public class FooMap extends WrappingMapTemplate&lt;Foo&gt; ...
public class FooArrayMap extends WrappingMapTemplate&lt;Foo&amp;gt ...
 
package x.y.z.test;
public class BarArray extends DirectArrayTemplate&lt;Bar&amp;gt ...
public class BarMapArray extends DirectArrayTemplate&lt;Bar&amp;gt ...
</code></pre>
</td>
</tr>
<tr class="even">
<td>
unions <br />
</td>
<td>
The name of the union class is determined in two ways. <br />
<br />
<b>1. Union without typeref</b> <br />
If there is no typeref for the union, the code generator makes up the class name from the name of the closest enclosing field that declared the union type. <br />
Package name is the package name of the closest outer record type, which follows the rule documented in this table for that closest outer record type. <br />
The generated union class will be declared in the generated class of the closest outer record type. <br />
Class name will be name of the field in the closest outer record that declared the union with the first character capitalized. <br />
<br />
<b>Example Schema</b> <pre><code>
{
  "type" : "record",
  "name" : "a.b.c.d.Foo",
  "fields" : [ { "name" : "bar", "type" : [ "int", "string" ] } ]
}
</code></pre>
<b>Java package and class</b> <pre><code>
package a.b.c.d;
public class Foo extends RecordTemplate {
  public class Bar extends UnionTemplate ...
}
</code></pre>
<b>2. Union with typeref</b> <br />
If there is a typeref for the union, the code generator will use the name of typeref for the generated union class. <br />
Package name is the package of the typeref if it is specified, otherwise package name is the namespace of the typeref by default. <br />
Class name is the name of the typeref.<br />
<br />
<b>Example Schema</b> 
<pre><code>
{
  "type" : "typeref",
  "name" : "a.b.c.d.Bar",
  "package" : "a.b.c.d.test",
  "ref"  : [ "int", "string" ] 
}
</code></pre><b>Java package and class</b>
<pre><code>
package a.b.c.d.test;
public class Bar extends UnionTemplate implements HasTyperefInfo {
  ...
  public TyperefInfo typerefInfo() 
  {
    ... 
  }
}
</code></pre>
When the typeref provides the name of the generated union class.   The generated class will also implement the <code>HasTyperefInfo</code> interface.  This interface declares the <code>typerefInfo()</code> method that will be implemented by the generated class.<br />
To avoid generating duplicate classes for the duplicate declarations of unions, it is a good practice to declare unions with a typeref when the same union type is used more than once.<br />
</td>
</tr>
<tr class="odd">
<td>
maps and arrays of unions <br />
</td>
<td>
Package name is the package name of the union, which follows the rule documented in this table for unions.  <br />
The generated class will be declared in the same outer class (for unions without typeref) or same package (for unions with typeref) as the generated class for the union. <br />
Class name is computed by appending "Map" or "Array" to the name of the generated class for the union. <br />
For multi-dimensional maps and arrays, a "Map" or "Array" is appended for each dimension starting the inner most dimension first. <br />
<br />
<b>1. Union without typeref</b><br />
<br />
<b>Example Schema</b> 
<pre>
<code>
{
  "type" : "record",
  "name" : "a.b.c.d.Foo",
  "fields" : [
    { "name" : "members", "type" : { "type" : "array", "items" : [ "int", "string" ] } }
    { "name" : "locations", "type" : { "type" : "map", "values" : [ "int", "string" ]  } }
  ]
}
</code>
</pre>

<b>Java package and class</b> 
<pre><code>
package a.b.c.d;
public class Foo extends RecordTemplate {
  public class Members extends UnionTemplate ...
  public class MembersArray extends WrappingArrayTemplate&lt;Members&gt; ...
  public class Locations extends UnionTemplate ...
  public class LocationsMap extends WrappingMapTemplate&lt;Locations&t; ...
 <br />
  public MembersArray getMembers() ...
  public LocationsMap getLocations() ...
}

</code></pre>

<b>2. Union with typeref</b><br />
<b>Example Schema</b> 
<pre><code>
{
  "type" : "typeref",
  "name" : "a.b.c.d.Bar",
  "package": "a.b.c.d.test",
  "ref"  : [ "int", "string" ] 
}
<br /> 
{
  "type" : "record",
  "name" : "a.b.c.d.Foo",
  "package" : "a.b.c.d.test",
  "fields" : [
    { "name" : "members", "type" : { "type" : "array", "items" : "Bar" } }
    { "name" : "locations", "type" : { "type" : "map", "values" : "Bar" } }
  ]
}
</code></pre><b>Java package and class</b> <br />
<pre><code>
package a.b.c.d.test;
<br /> 
public class Bar extends UnionTemplate ...
public class BarArray extends WrappingArrayTemplate&lt;Bar&gt; ...
public class BarMap extends WrappingMapTemplate&lt;Bar&gt; ...
<br /> 
public class Foo extends RecordTemplate
{
  public BarArray getMembers() ...
  public BarMap getLocations() ...
}
</code></pre><br /> 
</td>
</tr>
</tbody>
</table>

<h3 id="primitive-types">Primitive Types</h3>

<p>The Java binding for primitive schema types are as follows:</p>

<table>
  <thead>
    <tr>
      <th>Schema Type</th>
      <th>Java Type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>int <br /></td>
      <td><code class="highlighter-rouge">java.lang.Integer</code> or <code class="highlighter-rouge">int</code> (1) <br /></td>
    </tr>
    <tr>
      <td>long <br /></td>
      <td><code class="highlighter-rouge">java.lang.Long</code> or <code class="highlighter-rouge">long</code> (1) <br /></td>
    </tr>
    <tr>
      <td>float <br /></td>
      <td><code class="highlighter-rouge">java.lang.Float</code> or <code class="highlighter-rouge">float</code> (1) <br /></td>
    </tr>
    <tr>
      <td>double <br /></td>
      <td><code class="highlighter-rouge">java.lang.Double</code> or <code class="highlighter-rouge">double</code> (1) <br /></td>
    </tr>
    <tr>
      <td>boolean <br /></td>
      <td><code class="highlighter-rouge">java.lang.Boolean</code> or <code class="highlighter-rouge">boolean</code> (1) <br /></td>
    </tr>
    <tr>
      <td>string <br /></td>
      <td><code class="highlighter-rouge">java.lang.String</code> <br /></td>
    </tr>
    <tr>
      <td>bytes <br /></td>
      <td><code class="highlighter-rouge">com.linkedin.data.ByteString</code> <br /></td>
    </tr>
  </tbody>
</table>

<p>(1) Depending on the method, un-boxed types will be preferred to boxed
types if applicable when input or output arguments can never be null.</p>

<p>In addition to the standard bindings, custom Java class bindings may be
defined for these types to specify a user-defined class as substitute
for the standard Java class bindings. For additional details, see
<a href="#CustomJavaClassBindingforPrimitiveTypes">Custom Java Class Binding for Primitive
Types</a>.</p>

<h3 id="enum-type">Enum Type</h3>

<p>The code generator generates a Java enum class. There will be a
corresponding symbol in the Java enum class for each symbol in the enum
schema. In addition, the code generator will add a <code class="highlighter-rouge">$UNKNOWN</code> symbol to
the generated enum class. <code class="highlighter-rouge">$UNKNOWN</code> will be returned if the value
stored in the Data layer cannot be mapped to a symbol present in the
Java enum class. For example, this may occur if an enum symbol has been
added to a new version of the enum schema and is transmitted to client
that has not been updated with the new enum schema.</p>

<p>Enums also supports a symbolDocs attribute to provide documentation for
each enum symbol. E.g.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ...
    "symbols" : [ "APPLE", "BANANA", ... ],
    "symbolDocs" : { "APPLE":"A red, yellow or green fruit.", "BANANA":"A yellow fruit.", ... } 
  ...

</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">linkedin</span><span class="o">.</span><span class="na">pegasus</span><span class="o">.</span><span class="na">generator</span><span class="o">.</span><span class="na">examples</span><span class="o">;</span>
  
  <span class="o">...</span>
  <span class="cm">/**
  * A fruit
  *
  */</span>
  <span class="kd">public</span> <span class="kd">enum</span> <span class="n">Fruits</span> <span class="o">{</span>
  
      <span class="cm">/**
       * A red, yellow or green fruit.
       * 
       */</span>
      <span class="n">APPLE</span><span class="o">,</span>
  
      <span class="cm">/**
       * A yellow fruit.
       * 
       */</span>
      <span class="n">BANANA</span><span class="o">,</span>
  
      <span class="cm">/**
       * An orange fruit.
       * 
       */</span>
      <span class="n">ORANGE</span><span class="o">,</span>
  
      <span class="cm">/**
       * A yellow fruit.
       * 
       */</span>
      <span class="n">PINEAPPLE</span><span class="o">,</span>
      <span class="n">$UNKNOWN</span><span class="o">;</span>
  <span class="o">}</span>
</code></pre></div></div>

<p><strong>Note:</strong> Due to the addition of doclint in JDK8, anything under the
<code class="highlighter-rouge">symbolDocs</code> attribute must be W3C HTML 4.01 compliant. This is because
the contents of this string will appear as Javadocs in the generated
Java ‘data template’ classes later. Please take this into consideration
when writing your documentation.</p>

<h3 id="fixed-type">Fixed Type</h3>

<p>The code generator generates a class that extends
<code class="highlighter-rouge">com.linkedin.data.template.FixedTemplate</code>. This class provides the
following
methods:</p>

<table>
  <thead>
    <tr>
      <th>Method <br /></th>
      <th>Implemented by <br /></th>
      <th>Description <br /></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><em>Constructor</em>(String arg) <br /></td>
      <td>Generated class <br /></td>
      <td>Construct with an instance whose value is provided by the input string representing the bytes in the fixed. <br /></td>
    </tr>
    <tr>
      <td><em>Constructor</em>(Object obj) <br /></td>
      <td>Generated class <br /></td>
      <td>Construct with an instance whose value is provided by the input string representing the bytes in the fixed or a <code class="highlighter-rouge">ByteString</code>. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">ByteString bytes()</code> <br /></td>
      <td>Base class <br /></td>
      <td>Returns the bytes of the fixed type. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">FixedDataSchema schema()</code> <br /></td>
      <td>Generated class <br /></td>
      <td>Returns the <code class="highlighter-rouge">DataSchema</code> of the instance. The size of the fixed type can be obtained from this schema. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">Object data()</code> <br /></td>
      <td>Base class <br /></td>
      <td>Returns the underlying data of the instance. This is the same as bytes(). <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">String toString()</code> <br /></td>
      <td>Base class <br /></td>
      <td>Returns the string representation of the bytes in the instance. <br /></td>
    </tr>
  </tbody>
</table>

<p>A fixed instance is immutable once constructed.</p>

<h3 id="array-type">Array Type</h3>

<p>The code generator generates a class that extends
<code class="highlighter-rouge">com.linkedin.data.template.DirectArrayTemplate&lt;E&gt;</code> or
<code class="highlighter-rouge">com.linkedin.data.template.WrappingArrayTemplate&lt;E extends
DataTemplate&lt;?&gt;&gt;</code>. The latter is used for item types whose Java binding
require wrapping. The former is used for items types whose Java binding
that do not require wrapping. The <code class="highlighter-rouge">E</code> generic type variable is the Java
class of the array’s item type. By creating a concrete subclass per map
type, this binding avoids lost of item type information due to Java
generics type erasure.</p>

<p>The primary characteristics of both base classes are as follows:</p>

<ul>
  <li>They implement <code class="highlighter-rouge">java.util.List&lt;E&gt;</code>.</li>
  <li>Their methods perform runtime checks on updates and inserts to
ensure that the value types of arguments are either the exact type
specified by the type variable or types that can be coerced to the
specified type.</li>
</ul>

<p>The methods with more specific behavior are described
below.</p>

<table>
  <thead>
    <tr>
      <th>Method</th>
      <th>Implemented by <br /></th>
      <th>Description <br /></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><em>Constructor</em>()</td>
      <td>Generated class <br /></td>
      <td>Constructs an empty array. <br /></td>
    </tr>
    <tr>
      <td><em>Constructor</em>(int initialCapacity)</td>
      <td>Generated class</td>
      <td>Constructs an empty array with the specified initial capacity. <br /></td>
    </tr>
    <tr>
      <td><em>Constructor</em>(Collection<E> c)</E></td>
      <td>Generated class</td>
      <td>Constructs an array by inserting each element of the provided collection into the constructed array. <br /></td>
    </tr>
    <tr>
      <td><em>Constructor</em>(DataList list)</td>
      <td>Generated class</td>
      <td>Constructs an array that wraps the provided <code class="highlighter-rouge">DataList</code>. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">ArrayDataSchema schema()</code></td>
      <td>Generated class</td>
      <td>Returns the <code class="highlighter-rouge">DataSchema</code> of the instance. The schema of the items in the array can be obtained from this schema.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">int hashCode()</code> <br /></td>
      <td>Base class <br /></td>
      <td>Returns the <code class="highlighter-rouge">hashCode()</code> of the underlying <code class="highlighter-rouge">DataList</code> wrapped by this instance. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">boolean equals(Object object)</code> <br /></td>
      <td>Base class <br /></td>
      <td>If object is an instance of <code class="highlighter-rouge">AbstractArrayTemplate</code>, invoke equals on the underlying <code class="highlighter-rouge">DataList</code> of this instance and the object’s underlying <code class="highlighter-rouge">DataList</code>. Otherwise, invoke <code class="highlighter-rouge">super.equals(object)</code> which is <code class="highlighter-rouge">AbstractMap</code> ’s equals method. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">String toString()</code> <br /></td>
      <td>Base class <br /></td>
      <td>Returns the result of calling <code class="highlighter-rouge">toString()</code> on the underlying <code class="highlighter-rouge">DataList</code> wrapped by this instance. <br /></td>
    </tr>
    <tr>
      <td><em>java.util.List methods</em></td>
      <td>Base class <br /></td>
      <td>See <code class="highlighter-rouge">java.util.List</code>. <br /></td>
    </tr>
  </tbody>
</table>

<h3 id="map-type">Map Type</h3>

<p>The code generator generates a class that extends
<code class="highlighter-rouge">com.linkedin.data.template.DirectMapTemplate&lt;E&gt;</code> or
<code class="highlighter-rouge">com.linkedin.data.template.WrappingMapTemplate&lt;E extends
DataTemplate&lt;?&gt;&gt;</code>. The latter is used for item types whose Java binding
require wrapping. The former is used for items types whose Java binding
that do not require wrapping. The <code class="highlighter-rouge">E</code> generic type variable is the Java
class of the map’s value type. By creating a concrete subclass per map
type, this binding avoids lost of value type information due to Java
generics type erasure.</p>

<p>The primary characteristics of both base classes are as follows:</p>

<ul>
  <li>They implement <code class="highlighter-rouge">java.util.Map&lt;String, E&gt;</code>.</li>
  <li>Their methods perform runtime checks on updates and inserts to
ensure that the value types of arguments are either the exact type
specified by the type variable or are types that can be coerced to
the specified type.</li>
</ul>

<p>The methods with somewhat specialized behavior are described
below.</p>

<table>
  <thead>
    <tr>
      <th>Method</th>
      <th>Implemented by <br /></th>
      <th>Description <br /></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><em>Constructor</em>()</td>
      <td>Generated class <br /></td>
      <td>Constructs an empty map. <br /></td>
    </tr>
    <tr>
      <td><em>Constructor</em>(int initialCapacity)</td>
      <td>Generated class</td>
      <td>Constructs an empty map with the specified initial capacity. <br /></td>
    </tr>
    <tr>
      <td><em>Constructor</em>(int initialCapacity, float loadFactor)</td>
      <td>Generated class</td>
      <td>Constructs an empty map with the specified initial capacity and load factor. <br /></td>
    </tr>
    <tr>
      <td><em>Constructor</em>(Map&lt;String, E&gt; c)</td>
      <td>Generated class</td>
      <td>Constructs a map by inserting each entry of the provided map into new instance. <br /></td>
    </tr>
    <tr>
      <td><em>Constructor</em>(DataMap map)</td>
      <td>Generated class</td>
      <td>Constructs an array that wraps the provided <code class="highlighter-rouge">DataMap</code>. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">MapDataSchema schema()</code></td>
      <td>Generated class</td>
      <td>Returns the <code class="highlighter-rouge">DataSchema</code> of the instance. The schema of the values in the map can be obtained from this schema.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">int hashCode()</code> <br /></td>
      <td>Base class <br /></td>
      <td>Returns the <code class="highlighter-rouge">hashCode()</code> of the underlying <code class="highlighter-rouge">DataMap</code> wrapped by this instance. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">boolean equals(Object object)</code> <br /></td>
      <td>Base class <br /></td>
      <td>If object is an instance of <code class="highlighter-rouge">AbstractMapTemplate</code>, invoke equals on the underlying <code class="highlighter-rouge">DataMap</code> of this instance and the object’s underlying <code class="highlighter-rouge">DataMap</code>. Otherwise, invoke super.equals(object) which is <code class="highlighter-rouge">AbstractMap</code> ’s equals method. <br /></td>
    </tr>
    <tr>
      <td>String toString() <br /></td>
      <td>Base class <br /></td>
      <td>Returns the result of calling <code class="highlighter-rouge">toString()</code> on the underlying <code class="highlighter-rouge">DataMap</code> wrapped by this instance. <br /></td>
    </tr>
    <tr>
      <td><em>java.util.Map methods</em></td>
      <td>Base class <br /></td>
      <td>See <code class="highlighter-rouge">java.util.Map</code>. <br /></td>
    </tr>
  </tbody>
</table>

<h3 id="record-type">Record Type</h3>

<p>The code generator generates a class that extends
<code class="highlighter-rouge">com.linkedin.data.template.RecordTemplate</code>. This class provides the
following
methods:</p>

<table>
  <thead>
    <tr>
      <th>Method <br /></th>
      <th>Implemented by <br /></th>
      <th>Description <br /></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><em>Constructor</em>() <br /></td>
      <td>Generated class <br /></td>
      <td>Construct instance that wraps an empty <code class="highlighter-rouge">DataMap</code>. Even mandatory fields are not present. <br /></td>
    </tr>
    <tr>
      <td><em>Constructor</em>(DataMap map) <br /></td>
      <td>Generated class</td>
      <td>Construct instance that wraps the provided <code class="highlighter-rouge">DataMap</code>. Method invocations on the <code class="highlighter-rouge">RecordTemplate</code> translates to accesses to the underlying <code class="highlighter-rouge">DataMap</code>. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">RecordDataSchema schema()</code> <br /></td>
      <td>Generated class</td>
      <td>Returns the <code class="highlighter-rouge">DataSchema</code> of this instance. The fields of the record can be obtained from this schema. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">static Fields fields()</code> <br /></td>
      <td>Generated class</td>
      <td>Returns a generated <code class="highlighter-rouge">Fields</code> class that provides identifiers for fields of this record and certain nested types. See Fields section below. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">DataMap data()</code> <br /></td>
      <td>Base class</td>
      <td>Returns the underlying <code class="highlighter-rouge">DataMap</code> wrapped by this instance. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">String toString()</code> <br /></td>
      <td>Base class</td>
      <td>Equivalent to <code class="highlighter-rouge">data().toString()</code>. <br /></td>
    </tr>
  </tbody>
</table>

<p>The code generator generates the following methods in the generated
class for each field. <em>FieldName</em> is the name of field with the first
character
capitalized.</p>

<table>
  <thead>
    <tr>
      <th>Method</th>
      <th>Description <br /></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">boolean hasFieldName()</code> <br /></td>
      <td>Returns whether the field is present in the underlying <code class="highlighter-rouge">DataMap</code>. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">void removeFieldName()</code> <br /></td>
      <td>Removes the field from the underlying <code class="highlighter-rouge">DataMap</code>. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">T getFieldName(GetMode mode)</code> <br /></td>
      <td>Returns the value of the field. The mode parameter allows the client to specify the desired behavior if the field is not present. <code class="highlighter-rouge">T</code> is the Java type of the field.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">T getFieldName()</code> <br /></td>
      <td>Returns the value of the field. This is equivalent to <code class="highlighter-rouge">getFieldName(GetMode.STRICT)</code>. <code class="highlighter-rouge">T</code> is the Java type of the field. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">R setFieldName(T value, SetMode mode)</code></td>
      <td>Sets the specified value into the field. The mode parameter allows the client to specify the desired behavior if the provided value is null. Returns this. <code class="highlighter-rouge">R</code> is the generated Java class. <code class="highlighter-rouge">T</code> is the Java type of the field. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">R setFieldName(T value)</code> <br /></td>
      <td>Sets the specified value into the field. This is equivalent to <code class="highlighter-rouge">setFieldName(value, SetMode.DISALLOW_NULL)</code>. Returns this. <code class="highlighter-rouge">R</code> is the generated Java class. <code class="highlighter-rouge">T</code> is the native type rather than the corresponding boxed type where applicable, e.g. <code class="highlighter-rouge">int</code> instead of <code class="highlighter-rouge">Integer</code>. <br /></td>
    </tr>
  </tbody>
</table>

<p><a name="GetMode"></a></p>

<h4 id="getmode">GetMode</h4>

<p>When getting a field from a record, the caller must specify the behavior
of the function in case the requested field does not exist in the
record.</p>

<p>The available GetModes are:</p>

<ul>
  <li><code class="highlighter-rouge">NULL</code><br />
If the field is present, then return the value of the field. If the
field is not present, then return null (even if there is a default
value).</li>
  <li><code class="highlighter-rouge">DEFAULT</code><br />
If the field is present, then return the value of the field. If the
field is not present and there is a default value, then return the
default value. If the field is not present and there is no default
value, then return null.</li>
  <li><code class="highlighter-rouge">STRICT</code><br />
If the field is present, then return the value of the field.<br />
If the field is not present and the field has a default value, then
return the default value.<br />
If the field is not present and the field is not optional, then
throw
<code class="highlighter-rouge">com.linkedin.data.template.RequiredFieldNotPresentException</code>.<br />
If the field is not present and the field is optional, then return
null.</li>
</ul>

<h4 id="setmode">SetMode</h4>

<p>When setting a field in a record, the caller must specify the behavior
of the function in case the field is attempted to be set to <code class="highlighter-rouge">null</code>.</p>

<p>The available SetModes are:</p>

<ul>
  <li><code class="highlighter-rouge">IGNORE_NULL</code><br />
If the provided value is null, then do nothing i.e. the value of the
field is not changed. The field may or may be present.</li>
  <li><code class="highlighter-rouge">REMOVE_IF_NULL</code><br />
If the provided value is null, then remove the field. This occurs
regardless of whether the field is optional.</li>
  <li><code class="highlighter-rouge">REMOVE_OPTIONAL_IF_NULL</code><br />
If the provided value is null and the field is an optional field,
then remove the field. If the provided value is null and the field
is a mandatory field, then throw
<code class="highlighter-rouge">java.lang.IllegalArgumentException</code>.</li>
  <li><code class="highlighter-rouge">DISALLOW_NULL</code><br />
The provided value cannot be null. If the provided value is null,
then throw <code class="highlighter-rouge">java.lang.NullPointerException</code>.</li>
</ul>

<!-- end list -->

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">linkedin</span><span class="o">.</span><span class="na">pegasus</span><span class="o">.</span><span class="na">generator</span><span class="o">.</span><span class="na">examples</span><span class="o">;</span>
  
  <span class="o">...</span>
  
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="kd">extends</span> <span class="n">RecordTemplate</span>
  <span class="o">{</span>
      <span class="kd">public</span> <span class="nf">Foo</span><span class="o">()</span> <span class="o">...</span>
      <span class="kd">public</span> <span class="nf">Foo</span><span class="o">(</span><span class="n">DataMap</span> <span class="n">data</span><span class="o">)</span> <span class="o">...</span>
      <span class="o">...</span>
  
      <span class="c1">// intField - field of int type</span>
      <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasIntField</span><span class="o">()</span> <span class="o">...</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeIntField</span><span class="o">()</span> <span class="o">...</span>
      <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getIntField</span><span class="o">(</span><span class="n">GetMode</span> <span class="n">mode</span><span class="o">)</span> <span class="o">...</span>
      <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getIntField</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">getIntField</span><span class="o">(</span><span class="n">GetMode</span><span class="o">.</span><span class="na">STRICT</span><span class="o">);</span> <span class="o">}</span>
      <span class="kd">public</span> <span class="n">Foo</span> <span class="nf">setIntField</span><span class="o">(</span><span class="kt">int</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">;</span> <span class="k">return</span> <span class="k">this</span><span class="o">;</span> <span class="o">}</span>
      <span class="kd">public</span> <span class="n">Foo</span> <span class="nf">setIntField</span><span class="o">(</span><span class="n">Integer</span> <span class="n">value</span><span class="o">,</span> <span class="n">SetMode</span> <span class="n">mode</span> <span class="o">{</span> <span class="o">...</span> <span class="o">;</span> <span class="k">return</span> <span class="k">this</span><span class="o">;</span> <span class="o">}</span>
      <span class="o">...</span>
  
      <span class="c1">// bytesField - field of bytes, Java binding for bytes is ByteString</span>
      <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasBytesField</span><span class="o">()</span> <span class="o">...</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeBytesField</span><span class="o">()</span> <span class="o">...</span>
      <span class="kd">public</span> <span class="n">ByteString</span> <span class="nf">getBytesField</span><span class="o">(</span><span class="n">GetMode</span> <span class="n">mode</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">getBytesField</span><span class="o">(</span><span class="n">GetMode</span><span class="o">.</span><span class="na">STRICT</span><span class="o">);</span> <span class="o">}</span>
      <span class="kd">public</span> <span class="n">ByteString</span> <span class="nf">getBytesField</span><span class="o">()</span> <span class="o">...</span>
      <span class="kd">public</span> <span class="n">Foo</span> <span class="nf">setBytesField</span><span class="o">(</span><span class="n">ByteString</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">;</span> <span class="k">return</span> <span class="k">this</span><span class="o">;</span> <span class="o">}</span>
      <span class="kd">public</span> <span class="n">Foo</span> <span class="nf">setBytesField</span><span class="o">(</span><span class="n">ByteString</span> <span class="n">value</span><span class="o">,</span> <span class="n">SetMode</span> <span class="n">mode</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">;</span> <span class="k">return</span> <span class="k">this</span><span class="o">;</span> <span class="o">}</span>
      <span class="o">...</span>
  
      <span class="c1">// fruitsField - field of enum</span>
      <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasFruitsField</span><span class="o">()</span> <span class="o">...</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeFruitsField</span><span class="o">()</span> <span class="o">...</span>
      <span class="kd">public</span> <span class="n">Fruits</span> <span class="nf">getFruitsField</span><span class="o">(</span><span class="n">GetMode</span> <span class="n">mode</span><span class="o">)</span> <span class="o">...</span>
      <span class="kd">public</span> <span class="n">Fruits</span> <span class="nf">getFruitsField</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">getFruitsField</span><span class="o">(</span><span class="n">GetMode</span><span class="o">.</span><span class="na">STRICT</span><span class="o">);</span> <span class="o">}</span>
      <span class="kd">public</span> <span class="n">Foo</span> <span class="nf">setFruitsField</span><span class="o">(</span><span class="n">Fruits</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">;</span> <span class="k">return</span> <span class="k">this</span><span class="o">;</span> <span class="o">}</span>
      <span class="kd">public</span> <span class="n">Foo</span> <span class="nf">setFruitsField</span><span class="o">(</span><span class="n">Fruits</span> <span class="n">value</span><span class="o">,</span> <span class="n">SetMode</span> <span class="n">mode</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">;</span> <span class="k">return</span> <span class="k">this</span><span class="o">;</span> <span class="o">}</span>
      <span class="o">...</span>
  
      <span class="c1">// intArrayField - field of { "type" : "array", "items" : "int" }</span>
      <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasIntArrayField</span><span class="o">()</span> <span class="o">...</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeIntArrayField</span><span class="o">()</span> <span class="o">...</span>
      <span class="kd">public</span> <span class="n">IntegerArray</span> <span class="nf">getIntArrayField</span><span class="o">(</span><span class="n">GetMode</span> <span class="n">mode</span><span class="o">)</span> <span class="o">...</span>
      <span class="kd">public</span> <span class="n">IntegerArray</span> <span class="nf">getIntArrayField</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">getIntArrayField</span><span class="o">(</span><span class="n">GetMode</span><span class="o">.</span><span class="na">STRICT</span><span class="o">);</span> <span class="o">}</span>
      <span class="kd">public</span> <span class="n">Foo</span> <span class="nf">setIntArrayField</span><span class="o">(</span><span class="n">IntegerArray</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">;</span> <span class="k">return</span> <span class="k">this</span><span class="o">;</span> <span class="o">}</span>
      <span class="kd">public</span> <span class="n">Foo</span> <span class="nf">setIntArrayField</span><span class="o">(</span><span class="n">IntegerArray</span> <span class="n">value</span><span class="o">,</span> <span class="n">SetMode</span> <span class="n">mode</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">;</span> <span class="k">return</span> <span class="k">this</span><span class="o">;</span> <span class="o">}</span>
  
      <span class="c1">// stringMapField - field of { "type" : "map", "values" : "string" }</span>
      <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasStringMapField</span><span class="o">()</span> <span class="o">...</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeStringMapField</span><span class="o">()</span> <span class="o">...</span>
      <span class="kd">public</span> <span class="n">StringMap</span> <span class="nf">getStringMapField</span><span class="o">(</span><span class="n">GetMode</span> <span class="n">mode</span><span class="o">)</span> <span class="o">...</span>
      <span class="kd">public</span> <span class="n">StringMap</span> <span class="nf">getStringMapField</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">getIntStringMapField</span><span class="o">(</span><span class="n">GetMode</span><span class="o">.</span><span class="na">STRICT</span><span class="o">);</span> <span class="o">}</span>
      <span class="kd">public</span> <span class="n">Foo</span> <span class="nf">setStringMapField</span><span class="o">(</span><span class="n">StringMap</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">;</span> <span class="k">return</span> <span class="k">this</span><span class="o">;</span> <span class="o">}</span>
      <span class="kd">public</span> <span class="n">Foo</span> <span class="nf">setStringMapField</span><span class="o">(</span><span class="n">StringMap</span> <span class="n">value</span><span class="o">,</span> <span class="n">SetMode</span> <span class="n">mode</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">;</span> <span class="k">return</span> <span class="k">this</span><span class="o">;</span> <span class="o">}</span>
      <span class="o">...</span>
  
      <span class="c1">// unionField - field of union</span>
      <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasUnionField</span><span class="o">()</span> <span class="o">...</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeUnionField</span><span class="o">()</span> <span class="o">...</span>
      <span class="kd">public</span> <span class="n">Foo</span><span class="o">.</span><span class="na">UnionField</span> <span class="nf">getUnionField</span><span class="o">(</span><span class="n">GetMode</span> <span class="n">mode</span><span class="o">)</span> <span class="o">...</span>
      <span class="kd">public</span> <span class="n">Foo</span><span class="o">.</span><span class="na">UnionField</span> <span class="nf">getUnionField</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">getUnionField</span><span class="o">(</span><span class="n">GetMode</span><span class="o">.</span><span class="na">STRICT</span><span class="o">);</span> <span class="o">}</span>
      <span class="kd">public</span> <span class="n">Foo</span> <span class="nf">setUnionField</span><span class="o">(</span><span class="n">Foo</span><span class="o">.</span><span class="na">UnionField</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">;</span> <span class="k">return</span> <span class="k">this</span><span class="o">;</span> <span class="o">}</span>
      <span class="kd">public</span> <span class="n">Foo</span> <span class="nf">setUnionField</span><span class="o">(</span><span class="n">Foo</span><span class="o">.</span><span class="na">UnionField</span> <span class="n">value</span><span class="o">,</span> <span class="n">SetMode</span> <span class="n">mode</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">;</span> <span class="k">return</span> <span class="k">this</span><span class="o">;</span> <span class="o">}</span>
  
      <span class="c1">// get fields</span>
      <span class="kd">public</span> <span class="kd">static</span> <span class="n">Foo</span><span class="o">.</span><span class="na">Fields</span> <span class="nf">fields</span><span class="o">()</span> <span class="o">{</span>
          <span class="o">...;</span>
      <span class="o">}</span>
  
      <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Fields</span>
          <span class="kd">extends</span> <span class="n">PathSpec</span>
      <span class="o">{</span>
          <span class="o">...</span>
          <span class="kd">public</span> <span class="n">PathSpec</span> <span class="nf">intField</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
          <span class="kd">public</span> <span class="n">PathSpec</span> <span class="nf">longField</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
          <span class="kd">public</span> <span class="n">PathSpec</span> <span class="nf">bytesField</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
          <span class="kd">public</span> <span class="n">PathSpec</span> <span class="nf">fruitsField</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
          <span class="kd">public</span> <span class="n">PathSpec</span> <span class="nf">intArrayField</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
          <span class="kd">public</span> <span class="n">PathSpec</span> <span class="nf">stringMapField</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
          <span class="kd">public</span> <span class="n">Foo</span><span class="o">.</span><span class="na">UnionField</span><span class="o">.</span><span class="na">Fields</span> <span class="nf">unionField</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></div></div>

<h3 id="error-type">Error Type</h3>

<p>Error types are specialized record types. The code generator generates a
class that extends <code class="highlighter-rouge">com.linkedin.data.template.ExceptionTemplate</code>. The
generated class has the same methods as a generated class for a record
with the same fields. Unlike <code class="highlighter-rouge">RecordTemplate</code> instances,
<code class="highlighter-rouge">ExceptionTemplate</code> instances can be thrown and caught.
<code class="highlighter-rouge">ExceptionTemplate</code> extends <code class="highlighter-rouge">java.lang.Exception</code>.</p>

<h3 id="union-type">Union Type</h3>

<p>The code generator generates a class that extends
<code class="highlighter-rouge">com.linkedin.data.template.UnionTemplate</code>. This class provides the
following methods:</p>

<table>
  <thead>
    <tr>
      <th>Method <br /></th>
      <th>Implemented by <br /></th>
      <th>Description <br /></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">Constructor()</code> <br /></td>
      <td>Generated class <br /></td>
      <td>Construct a union with null as it value. An instance with null as its value cannot be assigned another value. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">Constructor(DataMap map)</code> <br /></td>
      <td>Generated class</td>
      <td>If the argument is null or <code class="highlighter-rouge">Data.NULL</code>, then construct a union with a null value. <br />If the argument is not null, then construct a union whose value is provided by the <code class="highlighter-rouge">DataMap</code>. Method invocations on the <code class="highlighter-rouge">UnionTemplate</code> translates to accesses to the underlying <code class="highlighter-rouge">DataMap</code>. <br />An instance with null as its value cannot be assigned another value. <br />An instance that has a non-null value cannot be later assigned a null value. <br />Note: This limitation is because the underlying data types that back the union for null verus non-null values are different. For non-null values, the underlying data type is a <code class="highlighter-rouge">DataMap</code>. For null values, the underlying data type is a string. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">UnionDataSchema schema()</code> <br /></td>
      <td>Generated class</td>
      <td>Returns the <code class="highlighter-rouge">DataSchema</code> of the instance. The members of the union can be obtained from this schema. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">DataScheme memberType()</code> <br /></td>
      <td>Base class <br /></td>
      <td>Returns <code class="highlighter-rouge">DataSchemaConstants.NULL_TYPE</code> if the union has a null value, else return the schema for the value. <br />If the schema cannot be determined, then throw <code class="highlighter-rouge">TemplateOutputCastException</code>. The schema cannot be determined if the content of the underlying <code class="highlighter-rouge">DataMap</code> cannot be resolved to a known member type of the union schema. See serialization format for details. This exception is thrown if the <code class="highlighter-rouge">DataMap</code> has more than one entry and the key of the only entry does not identify one of the member types of the union. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">boolean memberIs(String key)</code> <br /></td>
      <td>Base class <br /></td>
      <td>Returns whether the union member key of the current value is equal the specified key. The type of the current value is identified by the specified key if the underlying <code class="highlighter-rouge">DataMap</code> has a single entry and the entry’s key equals the specified key. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">boolean isNull()</code> <br /></td>
      <td>Base class <br /></td>
      <td>Returns whether the value of the union is null. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">Object data()</code> <br /></td>
      <td>Base class</td>
      <td>Returns <code class="highlighter-rouge">Data.NULL</code> if the union has a null value, else return the underlying <code class="highlighter-rouge">DataMap</code> fronted by the instance. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">String toString()</code> <br /></td>
      <td>Base class</td>
      <td>Equivalent to <code class="highlighter-rouge">data().toString()</code>. <br /></td>
    </tr>
  </tbody>
</table>

<p>The code generator generates the following methods in the generated
class for each member type of the union. In the following table,
<em>MemberKey</em> is either the member’s alias (if specified) or the member’s
non-fully qualified type name with the first character
capitalized.</p>

<table>
  <thead>
    <tr>
      <th>Method</th>
      <th>Description <br /></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">U createWithMemberKey(T value)</code> <br /></td>
      <td>Create a union instance with the specified value for the member identified by <em>MemberKey</em>. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">boolean isMemberKey()</code> <br /></td>
      <td>Returns whether the value of the union is of the member identified by the <em>MemberKey</em>. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">T getMemberKey()</code> <br /></td>
      <td>Returns the value of the union if it is for the member identified by <em>MemberKey</em>. <code class="highlighter-rouge">T</code> is the Java type of the value and if the current value is not of this type, then throw <code class="highlighter-rouge">TemplateOutputCastException</code>. <br /></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">void setMemberKey(T value)</code> <br /></td>
      <td>Sets the specified value into the union. <br /></td>
    </tr>
  </tbody>
</table>

<p>Here is an example generated class for a union who’s members are not
aliased.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">linkedin</span><span class="o">.</span><span class="na">pegasus</span><span class="o">.</span><span class="na">examples</span><span class="o">;</span>
  
  <span class="o">...</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="kd">extends</span> <span class="n">RecordTemplate</span>
  <span class="o">{</span>
      <span class="o">...</span>
      <span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">UnionField</span> <span class="kd">extends</span> <span class="n">UnionTemplate</span>
      <span class="o">{</span>
          <span class="kd">public</span> <span class="nf">UnionField</span><span class="o">()</span> <span class="o">...</span>
          <span class="kd">public</span> <span class="nf">UnionField</span><span class="o">(</span><span class="n">Object</span> <span class="n">data</span><span class="o">)</span> <span class="o">...</span>
  
          <span class="c1">// int value</span>
          <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isInt</span><span class="o">()</span> <span class="o">...</span>
          <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getInt</span><span class="o">()</span> <span class="o">...</span>
          <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setInt</span><span class="o">(</span><span class="n">Integer</span> <span class="n">value</span><span class="o">)</span> <span class="o">...</span>
  
          <span class="c1">// string value</span>
          <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isString</span><span class="o">()</span> <span class="o">...</span>
          <span class="kd">public</span> <span class="n">String</span> <span class="nf">getString</span><span class="o">()</span> <span class="o">...</span>
          <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setString</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">...</span>
  
          <span class="c1">// com.linkedin.pegasus.generator.examples.Fruits enum value</span>
          <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isFruits</span><span class="o">()</span> <span class="o">...</span>
          <span class="kd">public</span> <span class="n">Fruits</span> <span class="nf">getFruits</span><span class="o">()</span> <span class="o">...</span>
          <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFruits</span><span class="o">(</span><span class="n">Fruits</span> <span class="n">value</span><span class="o">)</span> <span class="o">...</span>
  
          <span class="c1">// com.linkedin.pegasus.generator.examples.Foo record value</span>
          <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isFoo</span><span class="o">()</span> <span class="o">...</span>
          <span class="kd">public</span> <span class="n">Foo</span> <span class="nf">getFoo</span><span class="o">()</span> <span class="o">...</span>
          <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFoo</span><span class="o">(</span><span class="n">Foo</span> <span class="n">value</span><span class="o">)</span> <span class="o">...</span>
  
          <span class="c1">// array value ({ "type" : "array", "items" : "string" })</span>
          <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isArray</span><span class="o">()</span> <span class="o">...</span>
          <span class="kd">public</span> <span class="n">StringArray</span> <span class="nf">getArray</span><span class="o">()</span> <span class="o">...</span>
          <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setArray</span><span class="o">(</span><span class="n">StringArray</span> <span class="n">value</span><span class="o">)</span> <span class="o">...</span>
  
          <span class="c1">// map value ({ "type" : "map", "values" : "long" })</span>
          <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isMap</span><span class="o">()</span> <span class="o">...</span>
          <span class="kd">public</span> <span class="n">LongMap</span> <span class="nf">getMap</span><span class="o">()</span> <span class="o">...</span>
          <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMap</span><span class="o">(</span><span class="n">LongMap</span> <span class="n">value</span><span class="o">)</span> <span class="o">...</span>
      <span class="o">}</span>
  
      <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Fields</span> <span class="kd">extends</span> <span class="n">PathSpec</span>
      <span class="o">{</span>
          <span class="o">...</span>
          <span class="kd">public</span> <span class="n">Foo</span><span class="o">.</span><span class="na">Fields</span> <span class="nf">Foo</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></div></div>

<p>For a union who’s members are aliased, the generated methods will use
the alias instead of the member’s type name like illustrated below.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">linkedin</span><span class="o">.</span><span class="na">pegasus</span><span class="o">.</span><span class="na">examples</span><span class="o">;</span>
  
  <span class="o">...</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="kd">extends</span> <span class="n">RecordTemplate</span>
  <span class="o">{</span>
      <span class="o">...</span>
      <span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">UnionField</span> <span class="kd">extends</span> <span class="n">UnionTemplate</span>
      <span class="o">{</span>
          <span class="kd">public</span> <span class="nf">UnionField</span><span class="o">()</span> <span class="o">...</span>
          <span class="kd">public</span> <span class="nf">UnionField</span><span class="o">(</span><span class="n">Object</span> <span class="n">data</span><span class="o">)</span> <span class="o">...</span>
  
          <span class="c1">// int with alias ({ "type" : "int", "alias" : "count" })</span>
          <span class="kd">public</span> <span class="n">UnionField</span> <span class="nf">createWithCount</span><span class="o">(</span><span class="n">Integer</span> <span class="n">value</span><span class="o">)</span> <span class="o">...</span>
          <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isCount</span><span class="o">()</span> <span class="o">...</span>
          <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getCount</span><span class="o">()</span> <span class="o">...</span>
          <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCount</span><span class="o">(</span><span class="n">Integer</span> <span class="n">value</span><span class="o">)</span> <span class="o">...</span>
  
          <span class="c1">// string with alias ({ "type" : "string", "alias" : "message" })</span>
          <span class="kd">public</span> <span class="n">UnionField</span> <span class="nf">createWithMessage</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">...</span>
          <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isMessage</span><span class="o">()</span> <span class="o">...</span>
          <span class="kd">public</span> <span class="n">String</span> <span class="nf">getMessage</span><span class="o">()</span> <span class="o">...</span>
          <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMessage</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">...</span>
  
          <span class="c1">// another string with alias ({ "type" : "string", "alias" : "greeting" })</span>
          <span class="kd">public</span> <span class="n">UnionField</span> <span class="nf">createWithGreeting</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">...</span>
          <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isGreeting</span><span class="o">()</span> <span class="o">...</span>
          <span class="kd">public</span> <span class="n">String</span> <span class="nf">getGreeting</span><span class="o">()</span> <span class="o">...</span>
          <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setGreeting</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">...</span>
      <span class="o">}</span>
  
      <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Fields</span> <span class="kd">extends</span> <span class="n">PathSpec</span>
      <span class="o">{</span>
          <span class="o">...</span>
          <span class="kd">public</span> <span class="n">Foo</span><span class="o">.</span><span class="na">Fields</span> <span class="nf">Foo</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></div></div>

<h3 id="custom-java-class-binding-for-primitive-types">Custom Java Class Binding for Primitive Types</h3>

<p>A typeref can also be used to define a custom Java class binding for a
primitive type. The primary intended use is to provide a more developer
friendly experience by having the framework perform conversions from
primitive type to a more friendly Java class that can implement methods
for manipulating the underlying primitive data. Custom Java class
binding also provides additional type-safety by allowing typerefs of the
same primitive type to be bound to different custom Java classes. This
enables compile time type-checking to disambiguate typeref’s, e.g. a Urn
typeref to a string can be bound to a different Java class than a
FileName typeref to a string.</p>

<p>When a typeref has a custom Java binding, the generated Java data
templates that reference this type will accept and return parameters of
the custom Java class instead of standard Java class for the primitive
type. The value stored in the underlying DataMap or DataList will always
be of the corresponding primitive Java type (not the custom Java type.)</p>

<p>A custom Java class binding is declared by:</p>

<ul>
  <li>defining a typeref of the primitive type,</li>
  <li>adding a “java” attribute whose value is a map to the typeref
declaration,</li>
  <li>adding a “class” attribute to the “java” map whose value is a string
that identifies the name of custom Java class.</li>
</ul>

<p>A custom class must meet the following requirements:</p>

<ol>
  <li>Instances of the custom class must be immutable.</li>
  <li>A coercer must be defined that can coerce the primitive Java class
of the type to the custom Java class of the type, in both the input
and output directions. The coercer implements the <code class="highlighter-rouge">DirectCoercer</code>
interface.</li>
  <li>An instance of the coercer must be registered with the data template
framework.</li>
</ol>

<!-- end list -->

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {
    "type" : "typeref",
    "name" : "CustomPoint",
    "ref"  : "string",
    "java" : {
      "class" : "CustomPoint"
    }
  }
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1">//</span>
  <span class="c1">// The custom class</span>
  <span class="c1">// It has to be immutable.</span>
  <span class="c1">//</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomPoint</span>
  <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">_x</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">_y</span><span class="o">;</span>
  
    <span class="kd">public</span> <span class="nf">CustomPoint</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">)</span>
    <span class="o">{</span>
      <span class="n">String</span> <span class="n">parts</span><span class="o">[]</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">","</span><span class="o">);</span>
      <span class="n">_x</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">parts</span><span class="s">"0"</span><span class="o">:</span><span class="mi">0</span><span class="o">);</span>
      <span class="n">_y</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">parts</span><span class="s">"1"</span><span class="o">:</span><span class="mi">1</span><span class="o">);</span>
    <span class="o">}</span>
  
    <span class="kd">public</span> <span class="nf">CustomPoint</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">y</span><span class="o">)</span>
    <span class="o">{</span>
      <span class="n">_x</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span>
      <span class="n">_y</span> <span class="o">=</span> <span class="n">y</span><span class="o">;</span>
    <span class="o">}</span>
  
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getX</span><span class="o">()</span>
    <span class="o">{</span>
      <span class="k">return</span> <span class="n">_x</span><span class="o">;</span>
    <span class="o">}</span>
  
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getY</span><span class="o">()</span>
    <span class="o">{</span>
      <span class="k">return</span> <span class="n">_y</span><span class="o">;</span>
    <span class="o">}</span>
  
    <span class="c1">// Implement equals, hashCode, toString, ...</span>
  
    <span class="c1">//</span>
    <span class="c1">// The custom class's DirectCoercer.</span>
    <span class="c1">//</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">CustomPointCoercer</span> <span class="kd">implements</span> <span class="n">DirectCoercer</span><span class="o">&lt;</span><span class="n">CustomPoint</span><span class="o">&gt;</span>
    <span class="o">{</span>
      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="n">Object</span> <span class="nf">coerceInput</span><span class="o">(</span><span class="n">CustomPoint</span> <span class="n">object</span><span class="o">)</span>
        <span class="kd">throws</span> <span class="n">ClassCastException</span>
      <span class="o">{</span>
        <span class="k">return</span> <span class="n">object</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
      <span class="o">}</span>
  
      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="n">CustomPoint</span> <span class="nf">coerceOutput</span><span class="o">(</span><span class="n">Object</span> <span class="n">object</span><span class="o">)</span>
        <span class="kd">throws</span> <span class="n">TemplateOutputCastException</span>
      <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">object</span> <span class="k">instanceof</span> <span class="n">String</span> <span class="o">==</span> <span class="kc">false</span><span class="o">)</span>
        <span class="o">{</span>
          <span class="k">throw</span> <span class="k">new</span> <span class="nf">TemplateOutputCastException</span><span class="o">(</span><span class="s">"Output "</span> <span class="o">+</span> <span class="n">object</span> <span class="o">+</span> 
                                                <span class="s">" is not a string, and cannot be coerced to "</span> <span class="o">+</span> 
                                                <span class="n">CustomPoint</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">CustomPoint</span><span class="o">((</span><span class="n">String</span><span class="o">)</span> <span class="n">object</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">}</span>
  
    <span class="c1">//</span>
    <span class="c1">// Automatically register Java custom class and its coercer.</span>
    <span class="c1">//</span>
    <span class="kd">static</span>
    <span class="o">{</span>
      <span class="n">Custom</span><span class="o">.</span><span class="na">registerCoercer</span><span class="o">(</span><span class="n">CustomPoint</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="k">new</span> <span class="n">CustomPointCoercer</span><span class="o">());</span>
    <span class="o">}</span>
  <span class="o">}</span>
</code></pre></div></div>

<h3 id="fields-class">Fields class</h3>

<p>The code generator also generates a <code class="highlighter-rouge">Fields</code> class within the generated
class for certain complex types. The primary use case for the <code class="highlighter-rouge">Fields</code>
class is to provide a type-safe way to refer or identify a field within
a record or a member of a union. The <code class="highlighter-rouge">Fields</code> class of a record is
accessed through the generated <code class="highlighter-rouge">fields()</code> method of the generated class
for a record. Only record types have the generated <code class="highlighter-rouge">fields()</code> method.</p>

<p>If there are nested complex types, a path to a particular nested field
may be obtained by chaining method invocations on <code class="highlighter-rouge">Fields</code> classes along
the path to the field, e.g. <code class="highlighter-rouge">Foo.fields().barField().bazField()</code>. The
path may be used to specify the nested fields to return from a resource
request, i.e. deep projection.</p>

<p>The following table summarizes which complex types will have a generated
<code class="highlighter-rouge">Fields</code> class and the content of the <code class="highlighter-rouge">Fields</code>
class.</p>

<table>
  <thead>
    <tr>
      <th>Complex type <br /></th>
      <th>Whether type will have a generated Fields class <br /></th>
      <th>Content of generated Fields class <br /></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>record <br /></td>
      <td>A <code class="highlighter-rouge">Fields</code> class always generated. <br /></td>
      <td>A method returning a <code class="highlighter-rouge">PathSpec</code> will be generated for each field of the record. <br /></td>
    </tr>
    <tr>
      <td>union <br /></td>
      <td>A <code class="highlighter-rouge">Fields</code> class always generated. <br /></td>
      <td>A method returning a <code class="highlighter-rouge">PathSpec</code> will be generated for each member of the union. <br /></td>
    </tr>
    <tr>
      <td>array <br /></td>
      <td>A <code class="highlighter-rouge">Fields</code> class will be generated if the array directly or indirectly contains a nested record or union. <br /></td>
      <td>An <code class="highlighter-rouge">items()</code> method returning a <code class="highlighter-rouge">PathSpec</code> will be generated for the array. <br /></td>
    </tr>
    <tr>
      <td>map <br /></td>
      <td>A <code class="highlighter-rouge">Fields</code> class will be generated if the map directly or indirectly contains a nested record or union. <br /></td>
      <td>A <code class="highlighter-rouge">values()</code> method returning a <code class="highlighter-rouge">PathSpec</code> will be generated for the map.</td>
    </tr>
  </tbody>
</table>

<h3 id="clone-method">Clone Method</h3>

<p>For the classes that wrap <code class="highlighter-rouge">DataMap</code> or <code class="highlighter-rouge">DataList</code>, their clone method
will clone the underlying <code class="highlighter-rouge">DataMap</code> or <code class="highlighter-rouge">DataList</code> and then create and
return a new <code class="highlighter-rouge">DataTemplate</code> of the same class to wrap the clone. This
clone operation performs a shallow copy.</p>

<h3 id="escaping-for-reserved-words">Escaping for Reserved Words</h3>

<p>When symbols such as schema names or enum symbol names are the same as
one of the reserved words in Java, the code generator will escape these
symbols by appending an underscore (“_”) to the name to obtain the Java
name of the symbol.</p>

<h3 id="exceptions">Exceptions</h3>

<p>The Data layer can throw two exceptions:</p>

<ul>
  <li><code class="highlighter-rouge">java.lang.ClassCastException</code> - This exception is thrown if the
input argument to a method is not the expected type, cannot be cast
or coerced to the expected type.</li>
  <li><code class="highlighter-rouge">com.linkedin.data.TemplateOutputCastException</code> - This exception if
the underlying data cannot be wrapped, cast or coerced to the type
to type of the output argument.</li>
</ul>

<p><a name="RunningtheCodeGenerator"></a></p>

<h3 id="running-the-code-generator">Running the Code Generator</h3>

<p>The code generator that generates the Java bindings is the
<code class="highlighter-rouge">com.linkedin.pegasus.generator.PegasusDataTemplateGenerator</code> class.</p>

<p>The arguments to the main method of this class are <code class="highlighter-rouge">targetDirectoryPath
[sourceFile or schemaName]+</code>”.</p>

<ul>
  <li><code class="highlighter-rouge">targetDirectoryPath</code> provides the root of the output directory for
Java source files generated by the code generator. The output
directory structure will follow the Java convention, with Java
source files residing in sub-directories corresponding to the
package name of the classes in the Java source files.</li>
  <li><code class="highlighter-rouge">sourceFile</code> provides the name of a file. Files containing schemas
should have an <code class="highlighter-rouge">.pdsc</code> extension. Although a file name provided as
an argument to the code generator need not end with <code class="highlighter-rouge">.pdsc</code>, only
<code class="highlighter-rouge">.pdsc</code> files will be read by the schema resolver when trying to
resolve a name to schema. Java type: <code class="highlighter-rouge">String</code>.</li>
  <li><code class="highlighter-rouge">schemaName</code> provides the fully qualified name of a schema. The
schema resolver computes a relative path name from this argument and
enumerate through resolver paths to locate a file with this relative
name. If a file is found, the code generator will parse the file
looking for a schema with the specified name. Java type: <code class="highlighter-rouge">String[]</code>.</li>
</ul>

<p>The resolver path is provided by the “generator.resolver.path” property.
Its format is the same as the format for Java classpath. Each path is
separated by a colon (“:”). Only file system directory paths may be
specified (i.e. the resolver does not comprehend <code class="highlighter-rouge">.jar</code> files in the
resolver path.). You can set this in java by <code class="highlighter-rouge">System.setProperty()</code>.</p>

<p>The dependencies of the code generator are:</p>

<ul>
  <li><code class="highlighter-rouge">com.sun.codemodel:codemodel:2.2</code></li>
  <li><code class="highlighter-rouge">org.codehaus.jackson-core-asl:jackson-core-asl:1.4.0</code></li>
  <li><code class="highlighter-rouge">com.linkedin.pegasus:cow</code></li>
  <li><code class="highlighter-rouge">com.linkedin.pegasus:r2</code></li>
  <li><code class="highlighter-rouge">com.linkedin.pegasus:generator</code></li>
</ul>

<h4 id="running-the-code-generator-from-command-line">Running the Code Generator from Command Line</h4>

<h4 id="running-the-code-generator-with-gradle">Running the Code Generator with Gradle</h4>

<p>A <code class="highlighter-rouge">dataTemplate.gradle</code> script is available in the <code class="highlighter-rouge">build_script/</code>
directory of pegasus. To use it, add the script to your project, then
add this to your <code class="highlighter-rouge">build.gradle</code> file:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  apply from: "${buildScriptDirPath}/dataTemplate.gradle"
</code></pre></div></div>

<p>and put the <code class="highlighter-rouge">.pdsc</code> files in a directory structure of the form:
‘src/\&lt;sourceset\&gt;/pegasus’, where typically it would be
<code class="highlighter-rouge">src/main/pegasus</code>. The plugin is set to trigger on this sort of
directory structure and have the files laid out like a java source tree,
ie if the namespace of my foo schema is “com.linkedin.foo.rest.api”, the
file would be located at
<code class="highlighter-rouge">src/main/pegasus/com/linkedin/foo/rest/api/Foo.pdsc</code>. See
<code class="highlighter-rouge">restli-example-api/build.gradle</code> in the Pegasus codebase for an
example. This script will generate the required Java classes before the
compileJava task, so that other classes can refer to it.</p>

<p>Note this will only generate the data templates, but further steps will
be needed to generate the rest.li IDL and the clientModel.</p>

<h2 id="avro-translation">Avro Translation</h2>

<h3 id="translating-schemas-to-and-from-avro">Translating Schemas to and from Avro</h3>

<p>The schema and data translators inspect your classpath to determine
which version of avro you are using and require you have the matching
pegasus `data-avro-<avro_version>\` adapter module in your classpath.</avro_version></p>

<p>For example, if you are using avro 1.6, you must add a dependency on the
pegasus `data-avro-1_6` module:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>com.linkedin.pegasus:data-avro-1_6:&lt;current-version&gt;  
</code></pre></div></div>

<p>If you are using avro 1.4, it’s adaptor module is included by default so
you don’t need to depend on it explicitly.</p>

<p>Schema translation is implemented by the
`com.linkedin.data.avro.SchemaTranslator` class.</p>

<p>For example, to convert from a avro schema, do:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DataSchema pegasusDataSchema =
SchemaTranslator.avroToDataSchema(avroSchema, options);  
</code></pre></div></div>

<p>And to convert to an avro schema, do:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Schema avroSchema = SchemaTranslator.dataToAvroSchema(pegasusDataSchema,
options);  
</code></pre></div></div>

<h3 id="translating-data-to-and-from-avro">Translating Data to and from Avro</h3>

<p>Data translation is implemented by the
`com.linkedin.data.avro.DataTranslator` class. Translating data
requires that one has schemas for both formats (.avsc and .pdsc). Please
see above section section about translating schemas for details. Once
both schemas are available, data can be converted.</p>

<p>For example, to convert avro data, do:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DataTranslator.dataMapToGenericRecord(data, pegasusDataSchema,
avroSchema); // for dataMaps  
// OR  
GenericRecord avroRecord =
DataTranslator.dataMapToGenericRecord(recordTemplate.data(),
recordTemplate(), avroSchema); // for record templates  
</code></pre></div></div>

<p>And to convert from avro data, do:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DataMap pegasusData = genericRecordToDataMap(avroRecord,
pegasusDataSchema, avroSchema);  
</code></pre></div></div>

                     </div>
                   </div>
</div>



      <footer class="page-footer">
    <div class="container">
      <div class="row">
        <div class="col s6">
          <h5>Rest.li</h5>
          <p class="text-lighten-4">Rest.li is an open source REST framework for building robust, scalable RESTful architectures using type-safe bindings and asynchronous, non-blocking IO. Rest.li fills a niche for applying RESTful principles at scale with an end-to-end developer workflow for building REST APIs, which promotes clean REST practices, uniform interface design and consistent data modeling.</p>
        </div>
        <div class="col s5 offset-s1">
          <h5 class="black-text">Community</h5>
          <ul>
              <li>Github <a class="" href="https://github.com/linkedin/rest.li">Rest.li</a></li>
              <li>Linkedin <a class="" href="http://www.linkedin.com/groups/Restli-4855943">Rest.li Group</a></li>
            <li>Follow us on twitter: <a class="" href="https://twitter.com/rest_li"> @rest_li</a></li>
            <li>Issue Tracking: <a class="" href="https://github.com/linkedin/rest.li/issues">github issue tracking</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="footer-copyright">
        <div class="container">
            <div class="row">
              <div class="col s6">
                      Copyright 2018 LinkedIn Corporation </br>
                      This work is licensed under a <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.  </br>
                      For clarity, no trademark is licensed.
                      </br></br>
              </div>
              <div class="col s5 offset-s1">
                      This work was made by using Jekyll (and a Jekyll Starter Template)</br>
                      <a target="_blank" href="https://github.com/macrod68/jekyll-materialize-starter-template">https://github.com/macrod68/jekyll-materialize-starter-template</a></br>
                      Copyright © 2017 Marco Damiani. Powered by <a target="_blank" href="http://jekyllrb.com/">Jekyll</a></br>
                      License:<a target="_blank" href="https://opensource.org/licenses/MIT">MIT</a>
              </div>
            </div>
        </div>
    </div>
    <script>
      $(function() {
        return $("h2, h3, h4, h5, h6").each(function(i, el) {
          var $el, icon, id;
          $el = $(el);
          id = $el.attr('id');
          icon = '<i class="fa fa-link"></i>';
          if (id) {
            return $el.append($("<a />").addClass("header-link").attr("href", "#" + id).html(icon));
          }
        });
      });
      </script>
</footer>
      
    <!--  Scripts-->                                                                               
<script src="/js/jquery.min.js"></script>
<script src="/js/materialize.min.js"></script>
<script src="/js/init.js"></script>

  </body>

</html>
